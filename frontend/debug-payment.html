<!DOCTYPE html>
<html>
<head>
    <title>Debug Payment Config</title>
</head>
<body>
    <h1>Payment Configuration Debug</h1>
    <pre id="output">Loading...</pre>

    <script type="module">
        const output = document.getElementById('output');

        const config = {
            // Environment variables
            VITE_API_URL: import.meta.env.VITE_API_URL,
            VITE_PAYPAL_ENABLED: import.meta.env.VITE_PAYPAL_ENABLED,
            VITE_PAYPAL_CLIENT_ID: import.meta.env.VITE_PAYPAL_CLIENT_ID,
            VITE_PAYPAL_ENV: import.meta.env.VITE_PAYPAL_ENV,
            VITE_PAYPAL_INTENT: import.meta.env.VITE_PAYPAL_INTENT,

            // Platform detection
            isNativePlatform: window.Capacitor?.isNativePlatform?.() || false,

            // Region detection
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            locale: navigator.language,
        };

        // Test getUserRegion logic
        const timezone = config.timezone;
        const locale = config.locale;
        const isIndia =
            timezone.includes('Kolkata') ||
            timezone.includes('Asia/Calcutta') ||
            locale.toLowerCase().includes('in');

        async function loadPricing() {
            try {
                const res = await fetch('/api/pricing');
                const data = await res.json();
                const formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: data.currency || 'USD' });
                config.detectedRegion = {
                    isIndia,
                    currency: data.currency || 'USD',
                    amount: Number(data.amount || 0),
                    displayPrice: formatter.format(Number(data.amount || 0))
                };
            } catch (error) {
                config.detectedRegion = { error: String(error) };
            }
        }

        // Test payment platform logic
        const isPaypalEnabled = !config.isNativePlatform && config.VITE_PAYPAL_ENABLED === 'true' && Boolean(config.VITE_PAYPAL_CLIENT_ID);

        config.paymentPlatform = isPaypalEnabled ? 'paypal' : 'none';

        await loadPricing();

        output.textContent = JSON.stringify(config, null, 2);
    </script>
</body>
</html>
