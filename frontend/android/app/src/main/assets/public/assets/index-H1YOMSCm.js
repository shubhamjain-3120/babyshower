const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dni46LMC.js","assets/react-vendor-wGySg1uH.js","assets/OnboardingScreen-B9dOC7am.js","assets/ResultScreen-DIbYnwQN.js"])))=>i.map(i=>d[i]);
import{r as a,a as ye,R as Re}from"./react-vendor-wGySg1uH.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var ge={exports:{}},H={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je=a,Le=Symbol.for("react.element"),Ie=Symbol.for("react.fragment"),Ae=Object.prototype.hasOwnProperty,Oe=je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ce={key:!0,ref:!0,__self:!0,__source:!0};function fe(e,o,n){var i,r={},s=null,u=null;n!==void 0&&(s=""+n),o.key!==void 0&&(s=""+o.key),o.ref!==void 0&&(u=o.ref);for(i in o)Ae.call(o,i)&&!Ce.hasOwnProperty(i)&&(r[i]=o[i]);if(e&&e.defaultProps)for(i in o=e.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:Le,type:e,key:s,ref:u,props:r,_owner:Oe.current}}H.Fragment=Ie;H.jsx=fe;H.jsxs=fe;ge.exports=H;var t=ge.exports,re={},se=ye;re.createRoot=se.createRoot,re.hydrateRoot=se.hydrateRoot;const Pe="modulepreload",$e=function(e){return"/"+e},ae={},ie=function(o,n,i){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),c=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));r=Promise.allSettled(n.map(g=>{if(g=$e(g),g in ae)return;ae[g]=!0;const f=g.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${h}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":Pe,f||(m.as="script"),m.crossOrigin="",m.href=g,c&&m.setAttribute("nonce",c),document.head.appendChild(m),f)return new Promise((w,l)=>{m.addEventListener("load",w),m.addEventListener("error",()=>l(new Error(`Unable to preload CSS for ${g}`)))})}))}function s(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return r.then(u=>{for(const c of u||[])c.status==="rejected"&&s(c.reason);return o().catch(s)})};function _e(){const[e,o]=a.useState(!1),[n,i]=a.useState(null),r=a.useRef(null),s=a.useRef(null),u=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),c=a.useCallback((f,h)=>{if(!u){alert("Voice input is not supported in this browser");return}r.current&&r.current.stop();const m=window.SpeechRecognition||window.webkitSpeechRecognition,w=new m;w.lang="en-IN",w.continuous=!1,w.interimResults=!1,w.maxAlternatives=1,s.current=h,w.onstart=()=>{o(!0),i(f)},w.onresult=l=>{const k=l.results[0][0].transcript,S=k.charAt(0).toUpperCase()+k.slice(1);s.current&&s.current(S)},w.onerror=l=>{console.error("Speech recognition error:",l.error),o(!1),i(null),l.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},w.onend=()=>{o(!1),i(null),r.current=null},r.current=w,w.start()},[u]),g=a.useCallback(()=>{r.current&&r.current.stop()},[]);return{isListening:e,activeField:n,startListening:c,stopListening:g,isSupported:u}}const De="wedding-invite-dev-mode";function X(){try{return localStorage.getItem(De)==="true"}catch{return!1}}function Be(e,o,n=null){if(!X())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;n!=null?console.log(`${r} ${o}`,n):console.log(`${r} ${o}`)}function Te(e,o,n){if(!X())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.error(`${r} ERROR - ${o}:`,n)}function Fe(e,o,n){if(!X())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.warn(`${r} WARN - ${o}:`,n)}function Z(e){return{log:(o,n=null)=>Be(e,o,n),error:(o,n)=>Te(e,o,n),warn:(o,n)=>Fe(e,o,n),isEnabled:X}}function he(e,o={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:e,...o})}function J(e,o={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",e,o)}const q="wedding-invite-rate-limit",B=10,le=7*24*60*60*1e3;function V(){try{const o=localStorage.getItem(q);if(o){const n=JSON.parse(o);if(Date.now()>n.resetAt){const i={count:0,resetAt:Date.now()+le};return localStorage.setItem(q,JSON.stringify(i)),{count:0,remaining:B,resetAt:i.resetAt,canGenerate:!0}}return{count:n.count,remaining:Math.max(0,B-n.count),resetAt:n.resetAt,canGenerate:n.count<B}}}catch(o){console.warn("[RateLimit] Failed to read state:",o)}const e={count:0,resetAt:Date.now()+le};try{localStorage.setItem(q,JSON.stringify(e))}catch(o){console.warn("[RateLimit] Failed to initialize state:",o)}return{count:0,remaining:B,resetAt:e.resetAt,canGenerate:!0}}function Me(){try{const e=V(),o=e.count+1,n={count:o,resetAt:e.resetAt};return localStorage.setItem(q,JSON.stringify(n)),{count:o,remaining:Math.max(0,B-o),resetAt:e.resetAt,canGenerate:o<B}}catch(e){return console.warn("[RateLimit] Failed to increment count:",e),V()}}function ce(e){const o=Date.now(),n=e-o;if(n<=0)return"now";const i=Math.floor(n/(24*60*60*1e3)),r=Math.floor(n%(24*60*60*1e3)/(60*60*1e3));if(i>0)return`${i} day${i>1?"s":""}`;if(r>0)return`${r} hour${r>1?"s":""}`;const s=Math.floor(n/(60*1e3));return`${s} minute${s>1?"s":""}`}function de(){return B}const D=Z("InputScreen"),ve="wedding-invite-form-cache",Ge="Hotel Jain Ji Shubham",T={name:50,venue:150},ne=e=>e?e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"",Ve=10*1024*1024,ze=["image/jpeg","image/png","image/webp","image/gif"],Ue=e=>e?e.size>Ve?{valid:!1,error:"File too large. Maximum size is 10MB."}:ze.includes(e.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"};function ue(e){if(!e)return"";const o=new Date(e),n={day:"numeric",month:"long",year:"numeric"};return o.toLocaleDateString("en-IN",n)}function We(){try{const e=localStorage.getItem(ve);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load cached form data:",e)}return null}function Ke(e){try{localStorage.setItem(ve,JSON.stringify(e))}catch(o){console.warn("Failed to save form data to cache:",o)}}function Je({onGenerate:e,error:o}){const[n,i]=a.useState(()=>V());a.useEffect(()=>{he("input"),i(V())},[]);const r=a.useMemo(()=>We(),[]),[s,u]=a.useState((r==null?void 0:r.brideName)||""),[c,g]=a.useState((r==null?void 0:r.groomName)||""),[f,h]=a.useState((r==null?void 0:r.weddingDate)||""),[m,w]=a.useState((r==null?void 0:r.venue)||"");a.useEffect(()=>{Ke({brideName:s,groomName:c,weddingDate:f,venue:m})},[s,c,f,m]);const[l,k]=a.useState(null),S=a.useMemo(()=>m.trim().toLowerCase()===Ge.toLowerCase(),[m]),[z,U]=a.useState(!1),[F,d]=a.useState(!1),[C,y]=a.useState(!1),[$,x]=a.useState(!1),[W,A]=a.useState(!1),[N,O]=a.useState(!1);a.useEffect(()=>{S&&!l&&(U(!0),fetch("/assets/dev-character.png").then(p=>{if(!p.ok)throw new Error("Failed to load dev character file");return p.blob()}).then(p=>{const L=p.type||"image/png",b=L.split("/")[1]||"png",M=new File([p],`dev-character.${b}`,{type:L});k(M),D.log("Auto-loaded dev character into photo",{size:`${(M.size/1024).toFixed(1)} KB`,detectedType:L})}).catch(p=>{D.error("Failed to auto-load dev character file",p.message),console.error("Failed to load dev character file:",p)}).finally(()=>{U(!1)}))},[S]);const E=a.useRef(null),{isListening:_,activeField:R,startListening:Q,stopListening:xe,isSupported:ee}=_e(),te=(p,L)=>{_&&R===p?xe():(J("voice_input_start",{field_name:p}),Q(p,L))},oe=l!==null,K=a.useMemo(()=>l?URL.createObjectURL(l):null,[l]);a.useEffect(()=>()=>{K&&URL.revokeObjectURL(K)},[K]);const Ne=p=>{const L=Array.from(p.target.files||[]);if(L.length===0)return;const b=L[0],M=Ue(b);if(!M.valid){alert(M.error),p.target.value="";return}k(b),p.target.value=""},Ee=()=>{J("photo_change"),k(null)},be=p=>{p.preventDefault(),D.log("Form submission started",{devMode:S,hasPhoto:!!l});const L=V();if(i(L),!L.canGenerate&&!S){D.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${de()} invites per week. Please try again in ${ce(L.resetAt)}.`);return}if(!s.trim()||!c.trim()||!f||!m.trim()){D.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!l){D.warn("Form validation","Photo required"),alert("Please upload a couple photo");return}const b={brideName:ne(s),groomName:ne(c),date:ue(f),venue:ne(m),photo:l,devMode:S,characterFile:S?l:null,skipExtraction:S?F:!1,skipImageGeneration:S?C:!1,skipBackgroundRemoval:S?$:!1,skipVideoGeneration:S?W:!1,forceServerConversion:S?N:!1};D.log("Form validation passed, calling onGenerate",{brideName:b.brideName,groomName:b.groomName,date:b.date,venue:b.venue,devMode:b.devMode,skipExtraction:b.skipExtraction,skipImageGeneration:b.skipImageGeneration,skipBackgroundRemoval:b.skipBackgroundRemoval,skipVideoGeneration:b.skipVideoGeneration,forceServerConversion:b.forceServerConversion,photoSize:l?`${(l.size/1024).toFixed(1)} KB`:null}),J("generate_submit",{dev_mode:S}),e(b)},ke=()=>oe?t.jsxs("div",{className:"photo-single",children:[t.jsx("div",{className:"photo-card photo-card-large",children:t.jsx("div",{className:"photo-preview",children:t.jsx("img",{src:K,alt:"Couple photo"})})}),t.jsx("button",{type:"button",className:"change-photos-btn",onClick:Ee,children:"Change Photo"})]}):t.jsx("div",{className:"photo-upload-empty",children:t.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var p;J("photo_upload_click"),(p=E.current)==null||p.click()},children:[t.jsx("span",{className:"upload-icon",children:"+"}),t.jsx("span",{className:"upload-text",children:"Upload Photo"}),t.jsx("span",{className:"upload-text-hindi",children:"‡§´‡§º‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç"}),t.jsx("span",{className:"upload-hint",children:"Select a couple photo with both groom and bride"}),t.jsx("span",{className:"upload-hint-hindi",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡§æ-‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡•Ä ‡§´‡§º‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"})]})});return t.jsxs("div",{className:"input-screen",children:[o&&t.jsx("div",{className:"error-banner",children:o}),t.jsxs("form",{onSubmit:be,className:"form",children:[t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"groomName",value:c,onChange:p=>g(p.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:T.name,required:!0}),ee&&t.jsx("button",{type:"button",className:`voice-btn ${_&&R==="groomName"?"listening":""}`,onClick:()=>te("groomName",g),"aria-label":"Voice input for groom name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),c.length>=T.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"brideName",value:s,onChange:p=>u(p.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:T.name,required:!0}),ee&&t.jsx("button",{type:"button",className:`voice-btn ${_&&R==="brideName"?"listening":""}`,onClick:()=>te("brideName",u),"aria-label":"Voice input for bride name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),s.length>=T.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),t.jsx("input",{type:"date",id:"weddingDate",value:f,onChange:p=>h(p.target.value),required:!0}),f&&t.jsx("span",{className:"date-preview",children:ue(f)})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"venue",value:m,onChange:p=>w(p.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:T.venue,required:!0}),ee&&t.jsx("button",{type:"button",className:`voice-btn ${_&&R==="venue"?"listening":""}`,onClick:()=>te("venue",w),"aria-label":"Voice input for venue",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),m.length>=T.venue&&t.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),S&&t.jsx("div",{className:"form-group",children:t.jsxs("div",{className:"dev-mode-section",children:[t.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),t.jsxs("div",{className:"dev-toggles-panel",children:[t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),t.jsx("button",{type:"button",className:`toggle-switch ${F?"toggle-on":""}`,onClick:()=>d(!F),"aria-label":"Toggle skip extraction",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${C?"toggle-on":""}`,onClick:()=>y(!C),"aria-label":"Toggle skip image generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),t.jsx("button",{type:"button",className:`toggle-switch ${$?"toggle-on":""}`,onClick:()=>x(!$),"aria-label":"Toggle skip background removal",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${W?"toggle-on":""}`,onClick:()=>A(!W),"aria-label":"Toggle skip video generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Force Server FFmpeg"}),t.jsx("button",{type:"button",className:`toggle-switch ${N?"toggle-on":""}`,onClick:()=>O(!N),"aria-label":"Toggle force server-side video conversion",children:t.jsx("span",{className:"toggle-knob"})})]})]}),z&&t.jsx("div",{className:"character-file-loading",children:"Loading dev character..."})]})}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Photo / ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),t.jsx("input",{type:"file",ref:E,accept:"image/*",onChange:Ne,style:{display:"none"}}),ke()]}),t.jsx("button",{type:"submit",className:"generate-btn",disabled:S?!oe||z:!oe||!n.canGenerate,children:S?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),!S&&t.jsx("div",{className:`rate-limit-info ${n.remaining<=2?"rate-limit-warning":""}`,children:n.canGenerate?t.jsxs("span",{children:[n.remaining," of ",de()," generations remaining this week",n.remaining<=2&&" ‚ö†Ô∏è"]}):t.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",ce(n.resetAt)]})})]})]})}function Ye({completed:e=!1}){const[o,n]=a.useState(0);return a.useEffect(()=>{he("loading")},[]),a.useEffect(()=>{e&&n(100)},[e]),a.useEffect(()=>{if(e||o>=90)return;const i=setInterval(()=>{n(r=>{if(r>=90)return clearInterval(i),90;const s=Math.floor(Math.random()*3)+1;return Math.min(r+s,90)})},1430);return()=>clearInterval(i)},[e,o>=90]),a.useEffect(()=>{if(o<90||e)return;const i=setInterval(()=>{n(r=>r>=99?(clearInterval(i),99):r+1)},7150);return()=>clearInterval(i)},[o>=90,e]),t.jsx("div",{className:"loading-screen",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),t.jsx("div",{className:"mascot-container mascot-container-large",children:t.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:i=>{i.target.style.display="none"}})}),t.jsxs("div",{className:"progress-container",children:[t.jsx("div",{className:"progress-bar",children:t.jsx("div",{className:"progress-fill",style:{width:`${o}%`}})}),t.jsxs("span",{className:"progress-text",children:[Math.round(o),"%"]})]}),t.jsx("p",{className:"loading-subtext",children:"Creating your beautiful wedding invite..."})]})})}var me;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(me||(me={}));var pe;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(pe||(pe={}));const P=Z("VideoComposer"),qe="https://marwadi-nyota.onrender.com".replace(/\/+$/,"");async function He({characterImage:e,brideName:o,groomName:n,date:i,venue:r,onProgress:s}){const u=performance.now();P.log("Starting server-side video composition",{characterImageLength:e==null?void 0:e.length,brideName:o,groomName:n,date:i,venue:r});const c=new FormData;if(e){const g=e.split(",")[1],f=atob(g),h=new Array(f.length);for(let l=0;l<f.length;l++)h[l]=f.charCodeAt(l);const m=new Uint8Array(h),w=new Blob([m],{type:"image/png"});c.append("characterImage",w,"character.png")}return c.append("brideName",o),c.append("groomName",n),c.append("date",i),c.append("venue",r),new Promise((g,f)=>{const h=new XMLHttpRequest;h.upload.onprogress=l=>{if(l.lengthComputable){const k=Math.round(l.loaded/l.total*30);P.log("Server compose upload progress",{progress:`${k}%`}),s(k)}},h.onload=()=>{if(h.status===200){const l=h.getResponseHeader("Content-Type");if(!l||!l.includes("video/mp4")){P.error("Server compose returned non-video response",{contentType:l}),f(new Error("Server returned non-video response. Check API URL configuration."));return}const k=performance.now()-u,S=h.response;P.log("Server-side video composition complete",{totalTime:`${k.toFixed(0)}ms`,outputSize:`${(S.size/1024/1024).toFixed(2)} MB`}),s(100),g(S)}else{P.error("Server compose failed",{status:h.status,statusText:h.statusText});try{const l=h.responseText,k=JSON.parse(l);f(new Error(k.error||"Server composition failed"))}catch{f(new Error("Server composition failed: unexpected response"))}}},h.onerror=()=>{const l=performance.now()-u;P.error("Server compose network error",{totalTime:`${l.toFixed(0)}ms`}),f(new Error("Network error during video composition"))},h.ontimeout=()=>{P.error("Server compose timeout"),f(new Error("Video composition timed out"))};let m=30;const w=setInterval(()=>{m<85&&(m+=2,s(m))},1e3);h.onloadend=()=>{clearInterval(w)},h.open("POST",`${qe}/api/compose-video`),h.responseType="blob",h.timeout=3e5,h.send(c)})}async function Xe({characterImage:e,brideName:o,groomName:n,date:i,venue:r,onProgress:s=()=>{}}){const u=performance.now();P.log("=== VIDEO COMPOSITION STARTED (SERVER-SIDE) ===",{brideName:o,groomName:n,date:i,venue:r,characterImageSize:e?`${(e.length/1024).toFixed(1)}KB`:"N/A",timestamp:new Date().toISOString(),userAgent:navigator.userAgent.slice(0,100)}),s(5);try{const c=await He({characterImage:e,brideName:o,groomName:n,date:i,venue:r,onProgress:s}),g=performance.now()-u;return P.log("=== VIDEO COMPOSITION COMPLETE (SERVER) ===",{totalTime:`${g.toFixed(0)}ms`,totalTimeHuman:`${(g/1e3).toFixed(1)}s`,outputSize:`${(c.size/1024/1024).toFixed(2)} MB`}),c}catch(c){const g=performance.now()-u;throw P.error("=== VIDEO COMPOSITION FAILED ===",{error:c.message,failedAfter:`${g.toFixed(0)}ms`}),c}}const j=Z("BgRemoval");let Y=null,G=null;const Ze={model:"medium",output:{format:"image/png",quality:1},progress:(e,o,n)=>{if(e==="compute:inference"){const i=Math.round(o/n*100);console.log(`[BgRemoval] Processing: ${i}%`)}}};async function Qe(){if(Y)return j.log("Library already loaded, using cached reference"),Y;if(G)return j.log("Library loading in progress, waiting..."),G;j.log("Loading library dynamically..."),console.log("[BgRemoval] Loading library dynamically...");const e=performance.now();return G=ie(()=>import("./index-Dni46LMC.js"),__vite__mapDeps([0,1])).then(o=>{Y=o.removeBackground;const n=performance.now()-e;return j.log("Library loaded",{duration:`${n.toFixed(0)}ms`}),console.log("[BgRemoval] Library loaded"),Y}).catch(o=>{throw G=null,o}),G}function we(e){const[o,n]=e.split(","),i=o.match(/:(.*?);/),r=i?i[1]:"image/png",s=atob(n),u=new Uint8Array(s.length);for(let c=0;c<s.length;c++)u[c]=s.charCodeAt(c);return new Blob([u],{type:r})}function et(e){return new Promise((o,n)=>{const i=new FileReader;i.onload=()=>o(i.result),i.onerror=n,i.readAsDataURL(e)})}async function tt(e){j.log("Starting background removal",{inputLength:e==null?void 0:e.length}),console.log("[BgRemoval] Starting background removal...");const o=performance.now();try{j.log("Step 1: Loading library");const n=await Qe();j.log("Step 2: Converting data URL to Blob");const i=we(e);j.log("Step 2 complete: Input prepared",{inputSize:`${(i.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Input size: ${(i.size/1024).toFixed(1)} KB`),j.log("Step 3: Calling removeBackground() - this may take a while...");const r=performance.now(),s=await n(i,Ze),u=performance.now()-r;j.log("Step 3 complete: Background removed",{processingTime:`${u.toFixed(0)}ms`,resultSize:`${(s.size/1024).toFixed(1)} KB`}),j.log("Step 4: Converting result to data URL");const c=await et(s),g=performance.now()-o;return j.log("Background removal complete",{totalDuration:`${g.toFixed(0)}ms`,inputSize:`${(i.size/1024).toFixed(1)} KB`,outputSize:`${(s.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Complete in ${g.toFixed(0)}ms`),console.log(`[BgRemoval] Output size: ${(s.size/1024).toFixed(1)} KB`),c}catch(n){throw j.error("Background removal failed",n),console.error("[BgRemoval] Error:",n),new Error(`Background removal failed: ${n.message}`)}}const ot=a.lazy(()=>ie(()=>import("./OnboardingScreen-B9dOC7am.js"),__vite__mapDeps([2,1]))),nt=a.lazy(()=>ie(()=>import("./ResultScreen-DIbYnwQN.js"),__vite__mapDeps([3,1]))),v=Z("App"),rt=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),t.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),it=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),t.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),st="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),I={ONBOARDING:"onboarding",INPUT:"input",LOADING:"loading",RESULT:"result"},Se="hasSeenOnboarding";function at(){try{return localStorage.getItem(Se)==="true"}catch{return!1}}function lt(){try{localStorage.setItem(Se,"true")}catch{}}const ct=500,dt=3,ut=1e3;async function mt(e,o,n=dt){let i;for(let r=0;r<n;r++){try{const s=await fetch(e,o);if(s.ok||s.status>=400&&s.status<500)return s;i=new Error(`Server error: ${s.status}`),v.warn(`API attempt ${r+1} failed with status ${s.status}`)}catch(s){i=s,v.warn(`API attempt ${r+1} failed: ${s.message}`)}if(r<n-1){const s=ut*Math.pow(2,r);v.log(`Retrying in ${s}ms...`),await new Promise(u=>setTimeout(u,s))}}throw i}function pt(){const[e,o]=a.useState(typeof navigator<"u"?navigator.onLine:!0);return a.useEffect(()=>{const n=()=>{o(!0),v.log("Network status: online")},i=()=>{o(!1),v.log("Network status: offline")};return window.addEventListener("online",n),window.addEventListener("offline",i),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}},[]),e}function gt(){const[e,o]=a.useState(()=>at()?I.INPUT:I.ONBOARDING),[n,i]=a.useState(null),[r,s]=a.useState(null),[u,c]=a.useState(null),[g,f]=a.useState(!1),h=pt(),[m,w]=a.useState(!0),l=a.useRef(null);a.useEffect(()=>{const d=new Audio("/assets/bg_audio.mp3");d.loop=!0,d.volume=.05,l.current=d;let C=!1;const y=async()=>{if(l.current&&l.current.paused)try{await l.current.play(),w(!0),console.log("[App] Music started after user interaction")}catch(x){console.log("[App] Could not play audio:",x.message)}document.removeEventListener("click",y),document.removeEventListener("touchstart",y),document.removeEventListener("keydown",y),C=!1};return(async()=>{try{await d.play(),w(!0),console.log("[App] Autoplay successful")}catch{console.log("[App] Autoplay blocked, waiting for user interaction"),document.addEventListener("click",y),document.addEventListener("touchstart",y),document.addEventListener("keydown",y),C=!0}})(),()=>{d.pause(),d.src="",C&&(document.removeEventListener("click",y),document.removeEventListener("touchstart",y),document.removeEventListener("keydown",y))}},[]);const k=a.useCallback(()=>{l.current&&(m?(l.current.pause(),w(!1)):(l.current.play().catch(()=>{console.log("[App] Could not play audio")}),w(!0)))},[m]);a.useEffect(()=>{e===I.RESULT&&l.current&&(l.current.pause(),w(!1),console.log("[App] Stopped background music for result screen"))},[e]);const S=a.useCallback(async d=>{var C,y,$;i(d),o(I.LOADING),f(!1),c(null),v.log("Generation started",{devMode:d.devMode,brideName:d.brideName,groomName:d.groomName,hasPhoto:!!d.photo,hasCharacterFile:!!d.characterFile,skipExtraction:d.skipExtraction,skipImageGeneration:d.skipImageGeneration,skipBackgroundRemoval:d.skipBackgroundRemoval,skipVideoGeneration:d.skipVideoGeneration,videoComposition:"server-side"});try{let x;if(d.devMode&&(d.skipExtraction||d.skipImageGeneration)&&d.characterFile)v.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:d.characterFile.name,fileSize:`${(d.characterFile.size/1024).toFixed(1)} KB`,fileType:d.characterFile.type}),console.log("[App] Dev mode enabled - using local character file"),x=await new Promise((N,O)=>{const E=new FileReader;E.onload=()=>{N(E.result)},E.onerror=()=>{O(new Error("Failed to read character file"))},E.readAsDataURL(d.characterFile)}),v.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:x.length}),console.log("[App] Character file loaded, skipping API calls");else{if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const N=new FormData;N.append("photo",d.photo),v.log("Step 1: Calling backend API",{photoName:d.photo.name,photoSize:`${(d.photo.size/1024).toFixed(1)} KB`,photoType:d.photo.type}),console.log("[App] Calling backend API...");const O=performance.now();let E;try{E=await mt(`${st}/api/generate`,{method:"POST",body:N})}catch(Q){throw Q}v.log("Step 1 response received",{status:E.status,ok:E.ok,duration:`${(performance.now()-O).toFixed(0)}ms`});const _=E.headers.get("content-type");if(!_||!_.includes("application/json"))throw new Error("Server returned non-JSON response. Check API URL configuration.");const R=await E.json();if(!R.success)throw v.error("Step 1 failed",R.error||"Generation failed"),new Error(R.error||"Generation failed");v.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!R.characterImage,imageLength:(C=R.characterImage)==null?void 0:C.length,evaluationScore:(y=R.evaluation)==null?void 0:y.score,evaluationPassed:($=R.evaluation)==null?void 0:$.passed}),console.log("[App] Received image from backend"),x=R.characterImage}if(d.skipBackgroundRemoval)v.log("Step 2: Skipping background removal (dev mode toggle)"),console.log("[App] Skipping background removal (dev mode)");else{v.log("Step 2: Starting background removal"),console.log("[App] Removing background...");const N=performance.now();try{x=await tt(x),v.log("Step 2 complete: Background removal successful",{outputLength:x==null?void 0:x.length,duration:`${(performance.now()-N).toFixed(0)}ms`}),console.log("[App] Background removal complete")}catch(O){v.warn("Step 2",`Background removal failed, using original: ${O.message}`),console.warn("[App] Background removal failed, using original:",O.message)}}let A;if(d.skipVideoGeneration)v.log("Step 3: Skipping video generation (dev mode toggle)"),console.log("[App] Skipping video generation (dev mode)"),A=we(x),v.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((A==null?void 0:A.size)/1024).toFixed(1)} KB`});else{v.log("Step 3: Starting video composition (server-side)",{brideName:d.brideName,groomName:d.groomName,date:d.date,venue:d.venue,characterImageLength:x==null?void 0:x.length}),console.log("[App] Composing video invite (server-side)...");const N=performance.now();let O=0;A=await Xe({characterImage:x,brideName:d.brideName,groomName:d.groomName,date:d.date,venue:d.venue,onProgress:E=>{(E>=O+20||E===100)&&(v.log("Video composition progress",{progress:`${E}%`,elapsed:`${(performance.now()-N).toFixed(0)}ms`}),O=E)}}),v.log("Step 3 complete: Video composition finished",{videoSize:`${((A==null?void 0:A.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-N).toFixed(0)}ms`})}if(s(A),!d.devMode){const N=Me();v.log("Rate limit updated",{count:N.count,remaining:N.remaining})}v.log("Step 4: Showing completion state"),console.log("[App] Generation complete! Showing 100% briefly..."),f(!0),await new Promise(N=>setTimeout(N,ct)),v.log("Step 5: Transitioning to result screen"),o(I.RESULT),v.log("Generation complete - all steps successful")}catch(x){v.error("Generation failed",x),console.error("[App] Generation error:",x),c(x.message),o(I.INPUT)}},[]),z=a.useCallback(()=>{o(I.INPUT),i(null),s(null),c(null)},[]),U=a.useCallback(()=>{lt(),o(I.INPUT)},[]),F=()=>t.jsx("div",{className:"loading-fallback",children:t.jsx("div",{className:"loading-spinner"})});return t.jsxs("div",{className:"app",children:[!h&&t.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),t.jsxs("header",{className:"app-header",children:[t.jsx("div",{className:"app-header-logo",children:t.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})}),t.jsxs("div",{className:"app-header-title",children:[t.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),t.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),t.jsx("div",{className:"app-header-actions",children:t.jsx("button",{className:"music-toggle-btn",onClick:k,"aria-label":m?"Mute background music":"Play background music",title:m?"Mute music":"Play music",children:m?t.jsx(rt,{}):t.jsx(it,{})})})]}),t.jsxs(a.Suspense,{fallback:t.jsx(F,{}),children:[e===I.ONBOARDING&&t.jsx(ot,{onComplete:U}),e===I.RESULT&&t.jsx(nt,{inviteVideo:r,brideName:n==null?void 0:n.brideName,groomName:n==null?void 0:n.groomName,onReset:z})]}),e===I.INPUT&&t.jsx(Je,{onGenerate:S,error:u}),e===I.LOADING&&t.jsx(Ye,{completed:g})]})}re.createRoot(document.getElementById("root")).render(t.jsx(Re.StrictMode,{children:t.jsx(gt,{})}));export{ie as _,J as a,Z as c,t as j,he as t};
