const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CY_Fjrjx.js","assets/react-vendor-wGySg1uH.js","assets/OnboardingScreen-M_uYPE2o.js","assets/ResultScreen-CZC2aAN8.js"])))=>i.map(i=>d[i]);
import{r as d,a as Ie,R as Ce}from"./react-vendor-wGySg1uH.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var fe={exports:{}},Z={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Te=d,Le=Symbol.for("react.element"),je=Symbol.for("react.fragment"),Ae=Object.prototype.hasOwnProperty,Oe=Te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fe={key:!0,ref:!0,__self:!0,__source:!0};function he(e,o,n){var a,s={},r=null,l=null;n!==void 0&&(r=""+n),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(l=o.ref);for(a in o)Ae.call(o,a)&&!Fe.hasOwnProperty(a)&&(s[a]=o[a]);if(e&&e.defaultProps)for(a in o=e.defaultProps,o)s[a]===void 0&&(s[a]=o[a]);return{$$typeof:Le,type:e,key:r,ref:l,props:s,_owner:Oe.current}}Z.Fragment=je;Z.jsx=he;Z.jsxs=he;fe.exports=Z;var t=fe.exports,re={},ie=Ie;re.createRoot=ie.createRoot,re.hydrateRoot=ie.hydrateRoot;const $e="modulepreload",De=function(e){return"/"+e},le={},se=function(o,n,a){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(n.map(i=>{if(i=De(i),i in le)return;le[i]=!0;const m=i.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":$e,m||(f.as="script"),f.crossOrigin="",f.href=i,c&&f.setAttribute("nonce",c),document.head.appendChild(f),m)return new Promise((w,u)=>{f.addEventListener("load",w),f.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${i}`)))})}))}function r(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&r(c.reason);return o().catch(r)})};function Pe(){const[e,o]=d.useState(!1),[n,a]=d.useState(null),s=d.useRef(null),r=d.useRef(null),l=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),c=d.useCallback((m,p)=>{if(!l){alert("Voice input is not supported in this browser");return}s.current&&s.current.stop();const f=window.SpeechRecognition||window.webkitSpeechRecognition,w=new f;w.lang="en-IN",w.continuous=!1,w.interimResults=!1,w.maxAlternatives=1,r.current=p,w.onstart=()=>{o(!0),a(m)},w.onresult=u=>{const x=u.results[0][0].transcript,E=x.charAt(0).toUpperCase()+x.slice(1);r.current&&r.current(E)},w.onerror=u=>{console.error("Speech recognition error:",u.error),o(!1),a(null),u.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},w.onend=()=>{o(!1),a(null),s.current=null},s.current=w,w.start()},[l]),i=d.useCallback(()=>{s.current&&s.current.stop()},[]);return{isListening:e,activeField:n,startListening:c,stopListening:i,isSupported:l}}const _e="wedding-invite-dev-mode";function Q(){try{return localStorage.getItem(_e)==="true"}catch{return!1}}function Be(e,o,n=null){if(!Q())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;n!=null?console.log(`${s} ${o}`,n):console.log(`${s} ${o}`)}function Ge(e,o,n){if(!Q())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.error(`${s} ERROR - ${o}:`,n)}function Me(e,o,n){if(!Q())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.warn(`${s} WARN - ${o}:`,n)}function ee(e){return{log:(o,n=null)=>Be(e,o,n),error:(o,n)=>Ge(e,o,n),warn:(o,n)=>Me(e,o,n),isEnabled:Q}}function ve(e,o={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:e,...o})}function q(e,o={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",e,o)}const X="wedding-invite-rate-limit",P=10,ce=7*24*60*60*1e3;function z(){try{const o=localStorage.getItem(X);if(o){const n=JSON.parse(o);if(Date.now()>n.resetAt){const a={count:0,resetAt:Date.now()+ce};return localStorage.setItem(X,JSON.stringify(a)),{count:0,remaining:P,resetAt:a.resetAt,canGenerate:!0}}return{count:n.count,remaining:Math.max(0,P-n.count),resetAt:n.resetAt,canGenerate:n.count<P}}}catch(o){console.warn("[RateLimit] Failed to read state:",o)}const e={count:0,resetAt:Date.now()+ce};try{localStorage.setItem(X,JSON.stringify(e))}catch(o){console.warn("[RateLimit] Failed to initialize state:",o)}return{count:0,remaining:P,resetAt:e.resetAt,canGenerate:!0}}function Ue(){try{const e=z(),o=e.count+1,n={count:o,resetAt:e.resetAt};return localStorage.setItem(X,JSON.stringify(n)),{count:o,remaining:Math.max(0,P-o),resetAt:e.resetAt,canGenerate:o<P}}catch(e){return console.warn("[RateLimit] Failed to increment count:",e),z()}}function de(e){const o=Date.now(),n=e-o;if(n<=0)return"now";const a=Math.floor(n/(24*60*60*1e3)),s=Math.floor(n%(24*60*60*1e3)/(60*60*1e3));if(a>0)return`${a} day${a>1?"s":""}`;if(s>0)return`${s} hour${s>1?"s":""}`;const r=Math.floor(n/(60*1e3));return`${r} minute${r>1?"s":""}`}function ue(){return P}const D=ee("InputScreen"),we="wedding-invite-form-cache",He="Hotel Jain Ji Shubham",B={name:50,venue:150},ne=e=>e?e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"",Ve=10*1024*1024,ze=["image/jpeg","image/png","image/webp","image/gif"],We=e=>e?e.size>Ve?{valid:!1,error:"File too large. Maximum size is 10MB."}:ze.includes(e.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"};function ge(e){if(!e)return"";const o=new Date(e),n={day:"numeric",month:"long",year:"numeric"};return o.toLocaleDateString("en-IN",n)}function Ke(){try{const e=localStorage.getItem(we);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load cached form data:",e)}return null}function Je(e){try{localStorage.setItem(we,JSON.stringify(e))}catch(o){console.warn("Failed to save form data to cache:",o)}}function qe({onGenerate:e,error:o}){const[n,a]=d.useState(()=>z());d.useEffect(()=>{ve("input"),a(z())},[]);const s=d.useMemo(()=>Ke(),[]),[r,l]=d.useState((s==null?void 0:s.brideName)||""),[c,i]=d.useState((s==null?void 0:s.groomName)||""),[m,p]=d.useState((s==null?void 0:s.weddingDate)||""),[f,w]=d.useState((s==null?void 0:s.venue)||"");d.useEffect(()=>{Je({brideName:r,groomName:c,weddingDate:m,venue:f})},[r,c,m,f]);const[u,x]=d.useState(null),E=d.useMemo(()=>f.trim().toLowerCase()===He.toLowerCase(),[f]),[_,W]=d.useState(!1),[G,te]=d.useState(!1),[M,g]=d.useState(!1),[O,R]=d.useState(!1),[F,$]=d.useState(!1),[S,ae]=d.useState(!1);d.useEffect(()=>{E&&!u&&(W(!0),fetch("/assets/dev-character.png").then(h=>{if(!h.ok)throw new Error("Failed to load dev character file");return h.blob()}).then(h=>{const j=h.type||"image/png",y=j.split("/")[1]||"png",H=new File([h],`dev-character.${y}`,{type:j});x(H),D.log("Auto-loaded dev character into photo",{size:`${(H.size/1024).toFixed(1)} KB`,detectedType:j})}).catch(h=>{D.error("Failed to auto-load dev character file",h.message),console.error("Failed to load dev character file:",h)}).finally(()=>{W(!1)}))},[E]);const T=d.useRef(null),{isListening:N,activeField:k,startListening:b,stopListening:K,isSupported:L}=Pe(),U=(h,j)=>{N&&k===h?K():(q("voice_input_start",{field_name:h}),b(h,j))},oe=u!==null,J=d.useMemo(()=>u?URL.createObjectURL(u):null,[u]);d.useEffect(()=>()=>{J&&URL.revokeObjectURL(J)},[J]);const be=h=>{const j=Array.from(h.target.files||[]);if(j.length===0)return;const y=j[0],H=We(y);if(!H.valid){alert(H.error),h.target.value="";return}x(y),h.target.value=""},ye=()=>{q("photo_change"),x(null)},Re=h=>{h.preventDefault(),D.log("Form submission started",{devMode:E,hasPhoto:!!u});const j=z();if(a(j),!j.canGenerate&&!E){D.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${ue()} invites per week. Please try again in ${de(j.resetAt)}.`);return}if(!r.trim()||!c.trim()||!m||!f.trim()){D.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!u){D.warn("Form validation","Photo required"),alert("Please upload a couple photo");return}const y={brideName:ne(r),groomName:ne(c),date:ge(m),venue:ne(f),photo:u,devMode:E,characterFile:E?u:null,skipExtraction:E?G:!1,skipImageGeneration:E?M:!1,skipBackgroundRemoval:E?O:!1,skipVideoGeneration:E?F:!1,forceServerConversion:E?S:!1};D.log("Form validation passed, calling onGenerate",{brideName:y.brideName,groomName:y.groomName,date:y.date,venue:y.venue,devMode:y.devMode,skipExtraction:y.skipExtraction,skipImageGeneration:y.skipImageGeneration,skipBackgroundRemoval:y.skipBackgroundRemoval,skipVideoGeneration:y.skipVideoGeneration,forceServerConversion:y.forceServerConversion,photoSize:u?`${(u.size/1024).toFixed(1)} KB`:null}),q("generate_submit",{dev_mode:E}),e(y)},ke=()=>oe?t.jsxs("div",{className:"photo-single",children:[t.jsx("div",{className:"photo-card photo-card-large",children:t.jsx("div",{className:"photo-preview",children:t.jsx("img",{src:J,alt:"Couple photo"})})}),t.jsx("button",{type:"button",className:"change-photos-btn",onClick:ye,children:"Change Photo"})]}):t.jsx("div",{className:"photo-upload-empty",children:t.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var h;q("photo_upload_click"),(h=T.current)==null||h.click()},children:[t.jsx("span",{className:"upload-icon",children:"+"}),t.jsx("span",{className:"upload-text",children:"Upload Photo"}),t.jsx("span",{className:"upload-text-hindi",children:"‡§´‡§º‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç"}),t.jsx("span",{className:"upload-hint",children:"Select a couple photo with both groom and bride"}),t.jsx("span",{className:"upload-hint-hindi",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡§æ-‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡•Ä ‡§´‡§º‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"})]})});return t.jsxs("div",{className:"input-screen",children:[o&&t.jsx("div",{className:"error-banner",children:o}),t.jsxs("form",{onSubmit:Re,className:"form",children:[t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"groomName",value:c,onChange:h=>i(h.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:B.name,required:!0}),L&&t.jsx("button",{type:"button",className:`voice-btn ${N&&k==="groomName"?"listening":""}`,onClick:()=>U("groomName",i),"aria-label":"Voice input for groom name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),c.length>=B.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"brideName",value:r,onChange:h=>l(h.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:B.name,required:!0}),L&&t.jsx("button",{type:"button",className:`voice-btn ${N&&k==="brideName"?"listening":""}`,onClick:()=>U("brideName",l),"aria-label":"Voice input for bride name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),r.length>=B.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),t.jsx("input",{type:"date",id:"weddingDate",value:m,onChange:h=>p(h.target.value),required:!0}),m&&t.jsx("span",{className:"date-preview",children:ge(m)})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"venue",value:f,onChange:h=>w(h.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:B.venue,required:!0}),L&&t.jsx("button",{type:"button",className:`voice-btn ${N&&k==="venue"?"listening":""}`,onClick:()=>U("venue",w),"aria-label":"Voice input for venue",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),f.length>=B.venue&&t.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),E&&t.jsx("div",{className:"form-group",children:t.jsxs("div",{className:"dev-mode-section",children:[t.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),t.jsxs("div",{className:"dev-toggles-panel",children:[t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),t.jsx("button",{type:"button",className:`toggle-switch ${G?"toggle-on":""}`,onClick:()=>te(!G),"aria-label":"Toggle skip extraction",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${M?"toggle-on":""}`,onClick:()=>g(!M),"aria-label":"Toggle skip image generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),t.jsx("button",{type:"button",className:`toggle-switch ${O?"toggle-on":""}`,onClick:()=>R(!O),"aria-label":"Toggle skip background removal",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${F?"toggle-on":""}`,onClick:()=>$(!F),"aria-label":"Toggle skip video generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Force Server FFmpeg"}),t.jsx("button",{type:"button",className:`toggle-switch ${S?"toggle-on":""}`,onClick:()=>ae(!S),"aria-label":"Toggle force server-side video conversion",children:t.jsx("span",{className:"toggle-knob"})})]})]}),_&&t.jsx("div",{className:"character-file-loading",children:"Loading dev character..."})]})}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Photo / ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),t.jsx("input",{type:"file",ref:T,accept:"image/*",onChange:be,style:{display:"none"}}),ke()]}),t.jsx("button",{type:"submit",className:"generate-btn",disabled:E?!oe||_:!oe||!n.canGenerate,children:E?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),!E&&t.jsx("div",{className:`rate-limit-info ${n.remaining<=2?"rate-limit-warning":""}`,children:n.canGenerate?t.jsxs("span",{children:[n.remaining," of ",ue()," generations remaining this week",n.remaining<=2&&" ‚ö†Ô∏è"]}):t.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",de(n.resetAt)]})})]})]})}function Ye({completed:e=!1,onCancel:o}){const[n,a]=d.useState(0);d.useEffect(()=>{ve("loading")},[]),d.useEffect(()=>{e&&a(100)},[e]);const s=r=>r<10?{fastTarget:10,slowTarget:20,fastInterval:1e3,slowInterval:5e3}:r<20?{fastTarget:10,slowTarget:20,fastInterval:1e3,slowInterval:5e3}:r<30?{fastTarget:30,slowTarget:40,fastInterval:1e3,slowInterval:5e3}:r<40?{fastTarget:30,slowTarget:40,fastInterval:1e3,slowInterval:5e3}:r<50?{fastTarget:50,slowTarget:60,fastInterval:1e3,slowInterval:5e3}:r<60?{fastTarget:50,slowTarget:60,fastInterval:1e3,slowInterval:5e3}:r<65?{fastTarget:65,slowTarget:70,fastInterval:1e3,slowInterval:5e3}:r<70?{fastTarget:65,slowTarget:70,fastInterval:1e3,slowInterval:5e3}:r<90?{fastTarget:90,slowTarget:98,fastInterval:1e3,slowInterval:5e3}:r<98?{fastTarget:90,slowTarget:98,fastInterval:1e3,slowInterval:5e3}:null;return d.useEffect(()=>{if(e||n>=98)return;const r=s(n);if(!r||n>=r.fastTarget)return;const l=setInterval(()=>{a(c=>{const i=c+1,m=s(c);return i>=m.fastTarget?(clearInterval(l),m.fastTarget):i})},r.fastInterval);return()=>clearInterval(l)},[e,n]),d.useEffect(()=>{if(e||n>=98)return;const r=s(n);if(!r||n<r.fastTarget||n>=r.slowTarget)return;const l=setInterval(()=>{a(c=>{const i=c+1,m=s(c);return i>=m.slowTarget?(clearInterval(l),m.slowTarget):i})},r.slowInterval);return()=>clearInterval(l)},[e,n]),t.jsx("div",{className:"loading-screen",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),t.jsx("div",{className:"mascot-container mascot-container-large",children:t.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:r=>{r.target.style.display="none"}})}),t.jsxs("div",{className:"progress-container",children:[t.jsx("div",{className:"progress-bar",children:t.jsx("div",{className:"progress-fill",style:{width:`${n}%`}})}),t.jsxs("span",{className:"progress-text",children:[Math.round(n),"%"]})]}),t.jsx("p",{className:"loading-subtext",children:"Creating your beautiful wedding invite..."}),o&&t.jsx("button",{className:"cancel-btn",onClick:o,type:"button",children:"Cancel (‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç)"})]})})}var me;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(me||(me={}));var pe;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(pe||(pe={}));const A=ee("VideoComposer"),Xe="https://marwadi-nyota.onrender.com".replace(/\/+$/,"");async function Ze({characterImage:e,brideName:o,groomName:n,date:a,venue:s,onProgress:r}){const l=performance.now();A.log("Starting server-side video composition",{characterImageLength:e==null?void 0:e.length,brideName:o,groomName:n,date:a,venue:s});const c=new FormData;if(e){const i=e.split(",")[1],m=atob(i),p=new Array(m.length);for(let u=0;u<m.length;u++)p[u]=m.charCodeAt(u);const f=new Uint8Array(p),w=new Blob([f],{type:"image/png"});c.append("characterImage",w,"character.png")}return c.append("brideName",o),c.append("groomName",n),c.append("date",a),c.append("venue",s),new Promise((i,m)=>{const p=new XMLHttpRequest;p.upload.onprogress=u=>{if(u.lengthComputable){const x=Math.round(u.loaded/u.total*30);A.log("Server compose upload progress",{progress:`${x}%`}),r(x)}},p.onload=()=>{if(p.status===200){const u=p.getResponseHeader("Content-Type");if(!u||!u.includes("video/mp4")){A.error("Server compose returned non-video response",{contentType:u}),m(new Error("Server returned non-video response. Check API URL configuration."));return}const x=performance.now()-l,E=p.response;A.log("Server-side video composition complete",{totalTime:`${x.toFixed(0)}ms`,outputSize:`${(E.size/1024/1024).toFixed(2)} MB`}),r(100),i(E)}else{A.error("Server compose failed",{status:p.status,statusText:p.statusText});try{const u=p.responseText,x=JSON.parse(u);m(new Error(x.error||"Server composition failed"))}catch(u){const x=p.responseText||"(empty response)",E=p.getResponseHeader("Content-Type")||"(not set)",_=p.getResponseHeader("Content-Length")||"(not set)";A.error("Server compose response unparseable",{status:p.status,statusText:p.statusText,contentType:E,contentLength:_,responseLength:x.length,firstChars:x.slice(0,300),parseError:u.message}),m(new Error("Server composition failed: unexpected response"))}}},p.onerror=()=>{const u=performance.now()-l;A.error("Server compose network error",{totalTime:`${u.toFixed(0)}ms`}),m(new Error("Network error during video composition"))},p.ontimeout=()=>{A.error("Server compose timeout"),m(new Error("Video composition timed out"))};let f=30;const w=setInterval(()=>{f<85&&(f+=2,r(f))},1e3);p.onloadend=()=>{clearInterval(w)},p.open("POST",`${Xe}/api/compose-video`),p.responseType="blob",p.timeout=3e5,p.send(c)})}async function Qe({characterImage:e,brideName:o,groomName:n,date:a,venue:s,onProgress:r=()=>{}}){const l=performance.now();A.log("=== VIDEO COMPOSITION STARTED (SERVER-SIDE) ===",{brideName:o,groomName:n,date:a,venue:s,characterImageSize:e?`${(e.length/1024).toFixed(1)}KB`:"N/A",timestamp:new Date().toISOString(),userAgent:navigator.userAgent.slice(0,100)}),r(5);try{const c=await Ze({characterImage:e,brideName:o,groomName:n,date:a,venue:s,onProgress:r}),i=performance.now()-l;return A.log("=== VIDEO COMPOSITION COMPLETE (SERVER) ===",{totalTime:`${i.toFixed(0)}ms`,totalTimeHuman:`${(i/1e3).toFixed(1)}s`,outputSize:`${(c.size/1024/1024).toFixed(2)} MB`}),c}catch(c){const i=performance.now()-l;throw A.error("=== VIDEO COMPOSITION FAILED ===",{error:c.message,failedAfter:`${i.toFixed(0)}ms`}),c}}const C=ee("BgRemoval");let Y=null,V=null;const et={model:"medium",output:{format:"image/png",quality:1},progress:(e,o,n)=>{if(e==="compute:inference"){const a=Math.round(o/n*100);console.log(`[BgRemoval] Processing: ${a}%`)}}};async function tt(){if(Y)return C.log("Library already loaded, using cached reference"),Y;if(V)return C.log("Library loading in progress, waiting..."),V;C.log("Loading library dynamically..."),console.log("[BgRemoval] Loading library dynamically...");const e=performance.now();return V=se(()=>import("./index-CY_Fjrjx.js"),__vite__mapDeps([0,1])).then(o=>{Y=o.removeBackground;const n=performance.now()-e;return C.log("Library loaded",{duration:`${n.toFixed(0)}ms`}),console.log("[BgRemoval] Library loaded"),Y}).catch(o=>{throw V=null,o}),V}function Ee(e){const[o,n]=e.split(","),a=o.match(/:(.*?);/),s=a?a[1]:"image/png",r=atob(n),l=new Uint8Array(r.length);for(let c=0;c<r.length;c++)l[c]=r.charCodeAt(c);return new Blob([l],{type:s})}function ot(e){return new Promise((o,n)=>{const a=new FileReader;a.onload=()=>o(a.result),a.onerror=n,a.readAsDataURL(e)})}async function nt(e){C.log("Starting background removal",{inputLength:e==null?void 0:e.length}),console.log("[BgRemoval] Starting background removal...");const o=performance.now();try{C.log("Step 1: Loading library");const n=await tt();C.log("Step 2: Converting data URL to Blob");const a=Ee(e);C.log("Step 2 complete: Input prepared",{inputSize:`${(a.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Input size: ${(a.size/1024).toFixed(1)} KB`),C.log("Step 3: Calling removeBackground() - this may take a while...");const s=performance.now(),r=await n(a,et),l=performance.now()-s;C.log("Step 3 complete: Background removed",{processingTime:`${l.toFixed(0)}ms`,resultSize:`${(r.size/1024).toFixed(1)} KB`}),C.log("Step 4: Converting result to data URL");const c=await ot(r),i=performance.now()-o;return C.log("Background removal complete",{totalDuration:`${i.toFixed(0)}ms`,inputSize:`${(a.size/1024).toFixed(1)} KB`,outputSize:`${(r.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Complete in ${i.toFixed(0)}ms`),console.log(`[BgRemoval] Output size: ${(r.size/1024).toFixed(1)} KB`),c}catch(n){throw C.error("Background removal failed",n),console.error("[BgRemoval] Error:",n),new Error(`Background removal failed: ${n.message}`)}}const rt=d.lazy(()=>se(()=>import("./OnboardingScreen-M_uYPE2o.js"),__vite__mapDeps([2,1]))),st=d.lazy(()=>se(()=>import("./ResultScreen-CZC2aAN8.js"),__vite__mapDeps([3,1]))),v=ee("App"),at=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),t.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),it=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),t.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),xe="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),I={ONBOARDING:"onboarding",INPUT:"input",LOADING:"loading",RESULT:"result"},Se="hasSeenOnboarding";function lt(){try{return localStorage.getItem(Se)==="true"}catch{return!1}}function ct(){try{localStorage.setItem(Se,"true")}catch{}}const dt=500,Ne=3,ut=1e3;async function gt(e,o,n=Ne,a=null){let s;const r=a?{...o,signal:a}:o;console.log("========== FETCH DEBUG START =========="),console.log("[FETCH] URL:",e),console.log("[FETCH] API_URL env var:",xe),console.log("[FETCH] Full URL being called:",e),console.log("[FETCH] Method:",(o==null?void 0:o.method)||"GET"),console.log("[FETCH] Has body:",!!(o!=null&&o.body)),console.log("[FETCH] Navigator online:",navigator.onLine),console.log("[FETCH] Window location:",window.location.href),console.log("[FETCH] Window origin:",window.location.origin);try{const l="https://httpbin.org/get";console.log("[FETCH] Testing basic connectivity to httpbin.org...");const c=await fetch(l,{method:"GET",mode:"cors"});console.log("[FETCH] Connectivity test result:",c.status)}catch(l){console.log("[FETCH] Connectivity test FAILED:",l.name,l.message)}for(let l=0;l<n;l++){if(a!=null&&a.aborted)throw new DOMException("Request was cancelled","AbortError");console.log(`[FETCH] Attempt ${l+1}/${n} starting...`);const c=Date.now();try{console.log("[FETCH] About to call fetch()...");const i=await fetch(e,r),m=Date.now()-c;console.log(`[FETCH] Response received in ${m}ms`),console.log("[FETCH] Status:",i.status),console.log("[FETCH] Status Text:",i.statusText),console.log("[FETCH] Response OK:",i.ok),console.log("[FETCH] Response type:",i.type),console.log("[FETCH] Response URL:",i.url);const p={};if(i.headers.forEach((f,w)=>{p[w]=f}),console.log("[FETCH] Response headers:",JSON.stringify(p)),i.ok||i.status>=400&&i.status<500)return console.log("[FETCH] Returning successful response"),console.log("========== FETCH DEBUG END =========="),i;s=new Error(`Server error: ${i.status}`),v.warn(`API attempt ${l+1} failed with status ${i.status}`),console.log("[FETCH] Server error, will retry...")}catch(i){const m=Date.now()-c;if(console.log(`[FETCH] EXCEPTION after ${m}ms`),console.log("[FETCH] Error name:",i.name),console.log("[FETCH] Error message:",i.message),console.log("[FETCH] Error stack:",i.stack),console.log("[FETCH] Full error object:",JSON.stringify(i,Object.getOwnPropertyNames(i))),i.name==="AbortError")throw console.log("[FETCH] Request was aborted"),console.log("========== FETCH DEBUG END =========="),i;s=i,v.warn(`API attempt ${l+1} failed: ${i.message}`)}if(l<n-1){const i=ut*Math.pow(2,l);console.log(`[FETCH] Retrying in ${i}ms...`),v.log(`Retrying in ${i}ms...`),await new Promise(m=>setTimeout(m,i))}}throw console.log("[FETCH] All retries exhausted, throwing error"),console.log("========== FETCH DEBUG END =========="),s}function mt(){const[e,o]=d.useState(typeof navigator<"u"?navigator.onLine:!0);return d.useEffect(()=>{const n=()=>{o(!0),v.log("Network status: online")},a=()=>{o(!1),v.log("Network status: offline")};return window.addEventListener("online",n),window.addEventListener("offline",a),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}},[]),e}function pt(){const[e,o]=d.useState(()=>lt()?I.INPUT:I.ONBOARDING),[n,a]=d.useState(null),[s,r]=d.useState(null),[l,c]=d.useState(null),[i,m]=d.useState(!1),p=mt(),[f,w]=d.useState(!0),u=d.useRef(null),x=d.useRef(null);d.useEffect(()=>{const g=new Audio("/assets/bg_audio.mp3");g.loop=!0,g.volume=.05,u.current=g;let O=!1;const R=async()=>{if(u.current&&u.current.paused)try{await u.current.play(),w(!0),console.log("[App] Music started after user interaction")}catch($){console.log("[App] Could not play audio:",$.message)}document.removeEventListener("click",R),document.removeEventListener("touchstart",R),document.removeEventListener("keydown",R),O=!1};return(async()=>{try{await g.play(),w(!0),console.log("[App] Autoplay successful")}catch{console.log("[App] Autoplay blocked, waiting for user interaction"),document.addEventListener("click",R),document.addEventListener("touchstart",R),document.addEventListener("keydown",R),O=!0}})(),()=>{g.pause(),g.src="",O&&(document.removeEventListener("click",R),document.removeEventListener("touchstart",R),document.removeEventListener("keydown",R))}},[]);const E=d.useCallback(()=>{u.current&&(f?(u.current.pause(),w(!1)):(u.current.play().catch(()=>{console.log("[App] Could not play audio")}),w(!0)))},[f]);d.useEffect(()=>{e===I.RESULT&&u.current&&(u.current.pause(),w(!1),console.log("[App] Stopped background music for result screen"))},[e]);const _=d.useCallback(async g=>{var R,F,$;x.current=new AbortController;const O=x.current.signal;a(g),o(I.LOADING),m(!1),c(null),v.log("Generation started",{devMode:g.devMode,brideName:g.brideName,groomName:g.groomName,hasPhoto:!!g.photo,hasCharacterFile:!!g.characterFile,skipExtraction:g.skipExtraction,skipImageGeneration:g.skipImageGeneration,skipBackgroundRemoval:g.skipBackgroundRemoval,skipVideoGeneration:g.skipVideoGeneration,videoComposition:"server-side"});try{let S;if(g.devMode&&(g.skipExtraction||g.skipImageGeneration)&&g.characterFile)v.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:g.characterFile.name,fileSize:`${(g.characterFile.size/1024).toFixed(1)} KB`,fileType:g.characterFile.type}),console.log("[App] Dev mode enabled - using local character file"),S=await new Promise((N,k)=>{const b=new FileReader;b.onload=()=>{N(b.result)},b.onerror=()=>{k(new Error("Failed to read character file"))},b.readAsDataURL(g.characterFile)}),v.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:S.length}),console.log("[App] Character file loaded, skipping API calls");else{if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const N=new FormData;N.append("photo",g.photo),v.log("Step 1: Calling backend API",{photoName:g.photo.name,photoSize:`${(g.photo.size/1024).toFixed(1)} KB`,photoType:g.photo.type}),console.log("[App] Calling backend API...");const k=performance.now();let b;try{b=await gt(`${xe}/api/generate`,{method:"POST",body:N},Ne,O)}catch(U){throw U}v.log("Step 1 response received",{status:b.status,ok:b.ok,duration:`${(performance.now()-k).toFixed(0)}ms`});const K=b.headers.get("content-type");if(!K||!K.includes("application/json"))throw new Error("Server returned non-JSON response. Check API URL configuration.");const L=await b.json();if(!L.success)throw v.error("Step 1 failed",L.error||"Generation failed"),new Error(L.error||"Generation failed");v.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!L.characterImage,imageLength:(R=L.characterImage)==null?void 0:R.length,evaluationScore:(F=L.evaluation)==null?void 0:F.score,evaluationPassed:($=L.evaluation)==null?void 0:$.passed}),console.log("[App] Received image from backend"),S=L.characterImage}if(g.skipBackgroundRemoval)v.log("Step 2: Skipping background removal (dev mode toggle)"),console.log("[App] Skipping background removal (dev mode)");else{v.log("Step 2: Starting background removal"),console.log("[App] Removing background...");const N=performance.now();try{S=await nt(S),v.log("Step 2 complete: Background removal successful",{outputLength:S==null?void 0:S.length,duration:`${(performance.now()-N).toFixed(0)}ms`}),console.log("[App] Background removal complete")}catch(k){v.warn("Step 2",`Background removal failed, using original: ${k.message}`),console.warn("[App] Background removal failed, using original:",k.message)}}let T;if(g.skipVideoGeneration)v.log("Step 3: Skipping video generation (dev mode toggle)"),console.log("[App] Skipping video generation (dev mode)"),T=Ee(S),v.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((T==null?void 0:T.size)/1024).toFixed(1)} KB`});else{v.log("Step 3: Starting video composition (server-side)",{brideName:g.brideName,groomName:g.groomName,date:g.date,venue:g.venue,characterImageLength:S==null?void 0:S.length}),console.log("[App] Composing video invite (server-side)...");const N=performance.now();let k=0;T=await Qe({characterImage:S,brideName:g.brideName,groomName:g.groomName,date:g.date,venue:g.venue,onProgress:b=>{(b>=k+20||b===100)&&(v.log("Video composition progress",{progress:`${b}%`,elapsed:`${(performance.now()-N).toFixed(0)}ms`}),k=b)}}),v.log("Step 3 complete: Video composition finished",{videoSize:`${((T==null?void 0:T.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-N).toFixed(0)}ms`})}if(r(T),!g.devMode){const N=Ue();v.log("Rate limit updated",{count:N.count,remaining:N.remaining})}v.log("Step 4: Showing completion state"),console.log("[App] Generation complete! Showing 100% briefly..."),m(!0),await new Promise(N=>setTimeout(N,dt)),v.log("Step 5: Transitioning to result screen"),o(I.RESULT),v.log("Generation complete - all steps successful")}catch(S){if(S.name==="AbortError"){v.log("Generation cancelled by user"),console.log("[App] Generation cancelled by user");return}v.error("Generation failed",S),console.error("[App] Generation error:",S),c(S.message),o(I.INPUT)}},[]),W=d.useCallback(()=>{x.current&&(x.current.abort(),x.current=null),v.log("User cancelled generation"),console.log("[App] User cancelled generation"),o(I.INPUT),a(null),r(null),m(!1),c(null)},[]),G=d.useCallback(()=>{o(I.INPUT),a(null),r(null),c(null)},[]),te=d.useCallback(()=>{ct(),o(I.INPUT)},[]),M=()=>t.jsx("div",{className:"loading-fallback",children:t.jsx("div",{className:"loading-spinner"})});return t.jsxs("div",{className:"app",children:[!p&&t.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),t.jsxs("header",{className:"app-header",children:[t.jsx("div",{className:"app-header-logo",children:t.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})}),t.jsxs("div",{className:"app-header-title",children:[t.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),t.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),t.jsx("div",{className:"app-header-actions",children:t.jsx("button",{className:"music-toggle-btn",onClick:E,"aria-label":f?"Mute background music":"Play background music",title:f?"Mute music":"Play music",children:f?t.jsx(at,{}):t.jsx(it,{})})})]}),t.jsxs(d.Suspense,{fallback:t.jsx(M,{}),children:[e===I.ONBOARDING&&t.jsx(rt,{onComplete:te}),e===I.RESULT&&t.jsx(st,{inviteVideo:s,brideName:n==null?void 0:n.brideName,groomName:n==null?void 0:n.groomName,onReset:G})]}),e===I.INPUT&&t.jsx(qe,{onGenerate:_,error:l}),e===I.LOADING&&t.jsx(Ye,{completed:i,onCancel:W})]})}re.createRoot(document.getElementById("root")).render(t.jsx(Ce.StrictMode,{children:t.jsx(pt,{})}));export{se as _,q as a,ee as c,t as j,ve as t};
