const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-6h72sOrQ.js","assets/react-vendor-wGySg1uH.js","assets/ResultScreen-sT8fT2vn.js"])))=>i.map(i=>d[i]);
import{r as c,a as Ke,R as We}from"./react-vendor-wGySg1uH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var Te={exports:{}},me={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ye=c,qe=Symbol.for("react.element"),He=Symbol.for("react.fragment"),Xe=Object.prototype.hasOwnProperty,Je=Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ze={key:!0,ref:!0,__self:!0,__source:!0};function $e(o,e,r){var n,s={},a=null,l=null;r!==void 0&&(a=""+r),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(l=e.ref);for(n in e)Xe.call(e,n)&&!Ze.hasOwnProperty(n)&&(s[n]=e[n]);if(o&&o.defaultProps)for(n in e=o.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:qe,type:o,key:a,ref:l,props:s,_owner:Je.current}}me.Fragment=He;me.jsx=$e;me.jsxs=$e;Te.exports=me;var t=Te.exports,xe={},be=Ke;xe.createRoot=be.createRoot,xe.hydrateRoot=be.hydrateRoot;const Qe="modulepreload",et=function(o){return"/"+o},Ee={},Be=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(r.map(d=>{if(d=et(d),d in Ee)return;Ee[d]=!0;const p=d.endsWith(".css"),u=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":Qe,p||(v.as="script"),v.crossOrigin="",v.href=d,i&&v.setAttribute("nonce",i),document.head.appendChild(v),p)return new Promise((N,f)=>{v.addEventListener("load",N),v.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return s.then(l=>{for(const i of l||[])i.status==="rejected"&&a(i.reason);return e().catch(a)})};function tt(){const[o,e]=c.useState(!1),[r,n]=c.useState(null),s=c.useRef(null),a=c.useRef(null),l=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),i=c.useCallback((p,u)=>{if(!l){alert("Voice input is not supported in this browser");return}s.current&&s.current.stop();const v=window.SpeechRecognition||window.webkitSpeechRecognition,N=new v;N.lang="en-IN",N.continuous=!1,N.interimResults=!1,N.maxAlternatives=1,a.current=u,N.onstart=()=>{e(!0),n(p)},N.onresult=f=>{const w=f.results[0][0].transcript,b=w.charAt(0).toUpperCase()+w.slice(1);a.current&&a.current(b)},N.onerror=f=>{console.error("Speech recognition error:",f.error),e(!1),n(null),f.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},N.onend=()=>{e(!1),n(null),s.current=null},s.current=N,N.start()},[l]),d=c.useCallback(()=>{s.current&&s.current.stop()},[]);return{isListening:o,activeField:r,startListening:i,stopListening:d,isSupported:l}}const ot="wedding-invite-dev-mode";function ge(){try{return localStorage.getItem(ot)==="true"}catch{return!1}}function rt(o,e,r=null){if(!ge())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${o}]`;r!=null?console.log(`${s} ${e}`,r):console.log(`${s} ${e}`)}function st(o,e,r){if(!ge())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${o}]`;console.error(`${s} ERROR - ${e}:`,r)}function nt(o,e,r){if(!ge())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${o}]`;console.warn(`${s} WARN - ${e}:`,r)}function ee(o){return{log:(e,r=null)=>rt(o,e,r),error:(e,r)=>st(o,e,r),warn:(e,r)=>nt(o,e,r),isEnabled:ge}}function pe(o,e={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:o,...e})}function Z(o,e={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",o,e)}const ue="wedding-invite-rate-limit",Q=10,ye=7*24*60*60*1e3;function le(){try{const e=localStorage.getItem(ue);if(e){const r=JSON.parse(e);if(Date.now()>r.resetAt){const n={count:0,resetAt:Date.now()+ye};return localStorage.setItem(ue,JSON.stringify(n)),{count:0,remaining:Q,resetAt:n.resetAt,canGenerate:!0}}return{count:r.count,remaining:Math.max(0,Q-r.count),resetAt:r.resetAt,canGenerate:r.count<Q}}}catch(e){console.warn("[RateLimit] Failed to read state:",e)}const o={count:0,resetAt:Date.now()+ye};try{localStorage.setItem(ue,JSON.stringify(o))}catch(e){console.warn("[RateLimit] Failed to initialize state:",e)}return{count:0,remaining:Q,resetAt:o.resetAt,canGenerate:!0}}function at(){try{const o=le(),e=o.count+1,r={count:e,resetAt:o.resetAt};return localStorage.setItem(ue,JSON.stringify(r)),{count:e,remaining:Math.max(0,Q-e),resetAt:o.resetAt,canGenerate:e<Q}}catch(o){return console.warn("[RateLimit] Failed to increment count:",o),le()}}function Ne(o){const e=Date.now(),r=o-e;if(r<=0)return"now";const n=Math.floor(r/(24*60*60*1e3)),s=Math.floor(r%(24*60*60*1e3)/(60*60*1e3));if(n>0)return`${n} day${n>1?"s":""}`;if(s>0)return`${s} hour${s>1?"s":""}`;const a=Math.floor(r/(60*1e3));return`${a} minute${a>1?"s":""}`}function Ie(){return Q}const ae=ee("InputScreen"),Me="wedding-invite-form-cache",it="Hotel Jain Ji Shubham",re={name:50,venue:150},fe=o=>o?o.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"";function Re(o){if(!o)return"";const e=new Date(o),r={day:"numeric",month:"long",year:"numeric"};return e.toLocaleDateString("en-IN",r)}function lt(){try{const o=localStorage.getItem(Me);if(o)return JSON.parse(o)}catch(o){console.warn("Failed to load cached form data:",o)}return null}function ct(o){try{localStorage.setItem(Me,JSON.stringify(o))}catch(e){console.warn("Failed to save form data to cache:",e)}}function dt({onGenerate:o,error:e,photo:r,onBack:n}){const[s,a]=c.useState(!1),[l,i]=c.useState(null),[d,p]=c.useState(()=>le());c.useEffect(()=>{pe("input"),p(le())},[]);const u=c.useMemo(()=>lt(),[]),[v,N]=c.useState((u==null?void 0:u.brideName)||""),[f,w]=c.useState((u==null?void 0:u.groomName)||""),[b,U]=c.useState((u==null?void 0:u.weddingDate)||""),[_,D]=c.useState((u==null?void 0:u.venue)||"");c.useEffect(()=>{ct({brideName:v,groomName:f,weddingDate:b,venue:_})},[v,f,b,_]);const E=c.useMemo(()=>_.trim().toLowerCase()===it.toLowerCase(),[_]),[V,te]=c.useState(!1),[y,k]=c.useState(!1),[T,K]=c.useState(!1),[$,W]=c.useState(!1),[m,M]=c.useState(!1),{isListening:A,activeField:G,startListening:Y,stopListening:ce,isSupported:oe}=tt(),h=(j,F)=>{A&&G===j?ce():(Z("voice_input_start",{field_name:j}),Y(j,F))},x=r!==null,he=j=>{j.preventDefault(),ae.log("Form submission started",{devMode:E,hasPhoto:!!r});const F=le();if(p(F),!F.canGenerate&&!E){ae.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${Ie()} invites per week. Please try again in ${Ne(F.resetAt)}.`);return}if(!v.trim()||!f.trim()||!b||!_.trim()){ae.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!r){ae.warn("Form validation","Photo required - should not happen"),alert("No photo selected. Please go back and upload a photo.");return}const L={brideName:fe(v),groomName:fe(f),date:Re(b),venue:fe(_),photo:r,devMode:E,characterFile:E?r:null,skipExtraction:E?V:!1,skipImageGeneration:E?y:!1,skipBackgroundRemoval:E?T:!1,skipVideoGeneration:E?$:!1,forceServerConversion:E?m:!1};ae.log("Form validation passed, showing confirmation modal",{brideName:L.brideName,groomName:L.groomName,date:L.date,venue:L.venue,devMode:L.devMode,skipExtraction:L.skipExtraction,skipImageGeneration:L.skipImageGeneration,skipBackgroundRemoval:L.skipBackgroundRemoval,skipVideoGeneration:L.skipVideoGeneration,forceServerConversion:L.forceServerConversion,photoSize:r?`${(r.size/1024).toFixed(1)} KB`:null}),Z("generate_submit",{dev_mode:E}),i(L),a(!0)};return t.jsxs("div",{className:"input-screen",children:[e&&t.jsx("div",{className:"error-banner",children:e}),s&&l&&t.jsx("div",{className:"confirmation-modal-overlay",children:t.jsxs("div",{className:"confirmation-modal",children:[t.jsxs("h2",{className:"modal-header",children:["‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç",t.jsx("span",{className:"modal-header-english",children:"(Please Confirm Details)"})]}),t.jsxs("div",{className:"modal-photo-container",children:[t.jsx("img",{src:URL.createObjectURL(r),alt:"Couple photo"}),t.jsx("p",{className:"modal-label",children:"‡§´‡•ã‡§ü‡•ã (Photo)"})]}),t.jsxs("div",{className:"modal-details",children:[t.jsxs("div",{className:"modal-detail-item",children:[t.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ (Groom's Name):"}),t.jsx("span",{className:"modal-detail-value",children:l.groomName})]}),t.jsxs("div",{className:"modal-detail-item",children:[t.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ (Bride's Name):"}),t.jsx("span",{className:"modal-detail-value",children:l.brideName})]}),t.jsxs("div",{className:"modal-detail-item",children:[t.jsx("span",{className:"modal-detail-label",children:"‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ (Wedding Date):"}),t.jsx("span",{className:"modal-detail-value",children:l.date})]}),t.jsxs("div",{className:"modal-detail-item",children:[t.jsx("span",{className:"modal-detail-label",children:"‡§∏‡•ç‡§•‡§æ‡§® (Venue):"}),t.jsx("span",{className:"modal-detail-value",children:l.venue})]})]}),t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{className:"modal-btn modal-btn-proceed",onClick:()=>{a(!1),o(l)},children:"‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç (Proceed)"}),t.jsx("button",{className:"modal-btn modal-btn-edit",onClick:()=>{a(!1),i(null)},children:"‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (Edit Details)"})]})]})}),t.jsx("div",{className:"hero-container",style:{marginBottom:"20px"},children:t.jsxs("div",{className:"sample-video-value-hindi",children:[t.jsx("label",{children:"‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç"}),t.jsx("p",{className:"form-hint",children:"Fill in your wedding details"})]})}),t.jsxs("form",{onSubmit:he,className:"form",children:[t.jsxs("div",{className:"form-row",children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"groomName",value:f,onChange:j=>w(j.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:re.name,required:!0}),oe&&t.jsx("button",{type:"button",className:`voice-btn ${A&&G==="groomName"?"listening":""}`,onClick:()=>h("groomName",w),"aria-label":"Voice input for groom name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),f.length>=re.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"brideName",value:v,onChange:j=>N(j.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:re.name,required:!0}),oe&&t.jsx("button",{type:"button",className:`voice-btn ${A&&G==="brideName"?"listening":""}`,onClick:()=>h("brideName",N),"aria-label":"Voice input for bride name",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),v.length>=re.name&&t.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),t.jsx("input",{type:"date",id:"weddingDate",value:b,onChange:j=>U(j.target.value),required:!0}),b&&t.jsx("span",{className:"date-preview",children:Re(b)})]}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),t.jsxs("div",{className:"input-with-voice",children:[t.jsx("input",{type:"text",id:"venue",value:_,onChange:j=>D(j.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:re.venue,required:!0}),oe&&t.jsx("button",{type:"button",className:`voice-btn ${A&&G==="venue"?"listening":""}`,onClick:()=>h("venue",D),"aria-label":"Voice input for venue",children:t.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[t.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),t.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),_.length>=re.venue&&t.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),E&&t.jsx("div",{className:"form-group",children:t.jsxs("div",{className:"dev-mode-section",children:[t.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),t.jsxs("div",{className:"dev-toggles-panel",children:[t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),t.jsx("button",{type:"button",className:`toggle-switch ${V?"toggle-on":""}`,onClick:()=>te(!V),"aria-label":"Toggle skip extraction",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${y?"toggle-on":""}`,onClick:()=>k(!y),"aria-label":"Toggle skip image generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),t.jsx("button",{type:"button",className:`toggle-switch ${T?"toggle-on":""}`,onClick:()=>K(!T),"aria-label":"Toggle skip background removal",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),t.jsx("button",{type:"button",className:`toggle-switch ${$?"toggle-on":""}`,onClick:()=>W(!$),"aria-label":"Toggle skip video generation",children:t.jsx("span",{className:"toggle-knob"})})]}),t.jsxs("div",{className:"dev-toggle-row",children:[t.jsx("span",{className:"dev-toggle-label",children:"Force Server FFmpeg"}),t.jsx("button",{type:"button",className:`toggle-switch ${m?"toggle-on":""}`,onClick:()=>M(!m),"aria-label":"Toggle force server-side video conversion",children:t.jsx("span",{className:"toggle-knob"})})]})]})]})}),t.jsx("button",{type:"submit",className:"generate-btn",disabled:!x||!E&&!d.canGenerate,children:E?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),n&&t.jsx("button",{type:"button",className:"go-back-btn",onClick:n,children:"Go Back (‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç)"}),!E&&t.jsx("div",{className:`rate-limit-info ${d.remaining<=2?"rate-limit-warning":""}`,children:d.canGenerate?t.jsxs("span",{children:[d.remaining," of ",Ie()," generations remaining this week",d.remaining<=2&&" ‚ö†Ô∏è"]}):t.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",Ne(d.resetAt)]})})]})]})}const ve=[{mrw:"‡§Ö‡§∏‡§≤‡•Ä ‡§¨‡§ú‡§ü ‡§ü‡•á‡§∏‡•ç‡§ü ‡§µ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§ï‡•ã‡§®‡•Ä, ‡§Æ‡§ø‡§†‡§æ‡§à ‡§∞‡•ã ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§π‡•à‡•§",en:"The real budget test isn't the venue, it's the ‡§Æ‡§ø‡§†‡§æ‡§à counter."},{mrw:"‡§Æ‡•á‡§π‡§Æ‡§æ‡§®‡§æ‡§Ç ‡§®‡•á ‡§µ‡§ö‡§®‡§æ‡§Ç ‡§∏‡•Ç‡§Ç ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§ñ‡§æ‡§®‡§æ ‡§Ø‡§æ‡§¶ ‡§∞‡§π ‡§ú‡§æ‡§µ‡•á‡•§",en:"Guests remember the food longer than the vows."},{mrw:"‡§•‡§æ‡§∞‡•Ä ‡§•‡§æ‡§≤‡•Ä ‡§Æ‡•á‡§Ç ‡§ò‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§π‡•à ‡§§‡•ã ‡§∏‡§Æ‡§ù ‡§ú‡§æ, ‡§∂‡§æ‡§¶‡•Ä ‡§ó‡§≤‡§§ ‡§π‡•à‡•§",en:"If there's no ghee on your plate, you're probably at the wrong wedding."},{mrw:"‡§ï‡•ã‡§à ‡§≠‡•Ç‡§ñ‡•ã ‡§ï‡•ã‡§®‡•Ä ‡§ú‡§æ‡§µ‡•á, ‡§™‡§∞ ‡§ï‡§à ‡§§‡•ã ‡§∏‡•Ä‡§ß‡•ã ‡§ö‡§æ‡§≤ ‡§≠‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§™‡§æ‡§µ‡•á‡•§",en:"No one leaves hungry, some leave unable to walk properly."},{mrw:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§∂‡§æ‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§á‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§æ‡§Ç ‡§∞‡•Ä ‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§π‡•ã ‡§ú‡§æ‡§µ‡•á‡•§",en:"In a Marwadi wedding, diet plans are officially suspended."},{mrw:"‡§∏‡§¨ ‡§∏‡•Ç‡§Ç ‡§≤‡§Ç‡§¨‡•Ä ‡§≤‡§æ‡§á‡§® ‡§¶‡•Ç‡§≤‡•ç‡§π‡§æ-‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§∞‡•Ä ‡§ï‡•ã‡§®‡•Ä, ‡§Æ‡§ø‡§†‡§æ‡§à ‡§∞‡•Ä ‡§π‡•ã‡§µ‡•á‡•§",en:"The longest queue isn't for the couple, it's for the dessert."},{mrw:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§∂‡§æ‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§•‡§æ‡§≤‡•Ä ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§π‡•ã‡§µ‡•á, ‡§¨‡§∏ ‡§∞‡•Ä‡§´‡§ø‡§≤‡§æ‡§Ç ‡§∞‡§æ ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§µ‡•á‡•§",en:"At Marwadi weddings, plates are never truly empty ‚Äî only between refills."},{mrw:"‡§≤‡•ã‡§ó ‡§Ü‡§∂‡•Ä‡§∞‡•ç‡§µ‡§æ‡§¶ ‡§¶‡•á‡§£ ‡§Ü‡§µ‡•á, ‡§™‡§£ ‡§∞‡•Å‡§ï‡•ç‡§ï‡•á ‡§®‡§æ‡§∂‡•ç‡§§‡•á ‡§ñ‡§æ‡§§‡§∞‡•§",en:"People come for blessings, stay for the snacks."}];function ut({completed:o=!1,onCancel:e}){const[r,n]=c.useState(0),[s,a]=c.useState(0),[l,i]=c.useState(!1),d=c.useRef(null),p=c.useRef(null);return c.useEffect(()=>{pe("loading")},[]),c.useEffect(()=>(p.current=setInterval(()=>{a(u=>(u+1)%ve.length)},5e3),()=>{p.current&&clearInterval(p.current)}),[]),c.useEffect(()=>{o&&r<100&&(d.current&&(clearTimeout(d.current),d.current=null),i(!0),n(100))},[o,r]),c.useEffect(()=>{if(o||r>=100||r>=98)return;let u;return r<90?u=1e3+Math.random()*2e3:u=5e3,d.current=setTimeout(()=>{n(v=>v>=98?v:v+1)},u),()=>{d.current&&(clearTimeout(d.current),d.current=null)}},[r,o]),t.jsx("div",{className:"loading-screen",children:t.jsxs("div",{className:"loading-content",children:[t.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),t.jsx("div",{className:"mascot-container mascot-container-large",children:t.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:u=>{u.target.style.display="none"}})}),t.jsxs("div",{className:"progress-container",children:[t.jsx("div",{className:"progress-bar",children:t.jsx("div",{className:`progress-fill ${l?"completing":""}`,style:{width:`${r}%`}})}),t.jsxs("span",{className:"progress-text",children:[Math.round(r),"%"]})]}),t.jsxs("div",{className:"loading-trivia",children:[t.jsx("p",{className:"trivia-primary",children:ve[s].mrw}),t.jsx("p",{className:"trivia-secondary",children:ve[s].en})]}),e&&t.jsx("button",{className:"cancel-btn",onClick:e,type:"button",children:"Cancel (‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç)"})]})})}function mt({onProceed:o}){c.useEffect(()=>{pe("sample_video")},[]);const e=()=>{Z("sample_video_proceed"),o()};return t.jsx("div",{className:"input-screen",children:t.jsxs("div",{className:"form",style:{gap:"16px"},children:[t.jsx("div",{className:"hero-container",children:t.jsxs("div",{className:"sample-video-value-hindi",children:[t.jsx("label",{children:"‡§è‡§ï ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç. ‡§Æ‡§ø‡§®‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§è‡§Å WhatsApp-ready ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£."}),t.jsx("p",{className:"form-hint",children:"Upload one photo. Get a WhatsApp-ready video invite in minutes."})]})}),t.jsx("div",{className:"form-group",children:t.jsx("video",{className:"sample-video-player",src:"/assets/sample.mp4",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!0})}),t.jsx("button",{className:"generate-btn",style:{marginTop:"0"},onClick:e,children:"‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (Upload Photo)"})]})})}const B=ee("BgRemoval");let de=null,ie=null;const gt={model:"small",output:{format:"image/png",quality:1},progress:(o,e,r)=>{if(o==="compute:inference"){const n=Math.round(e/r*100);console.log(`[BgRemoval] Processing: ${n}%`)}}};async function pt(){if(de)return B.log("Library already loaded, using cached reference"),de;if(ie)return B.log("Library loading in progress, waiting..."),ie;B.log("Loading library dynamically..."),console.log("[BgRemoval] Loading library dynamically...");const o=performance.now();return ie=Be(()=>import("./index-6h72sOrQ.js"),__vite__mapDeps([0,1])).then(e=>{de=e.removeBackground;const r=performance.now()-o;return B.log("Library loaded",{duration:`${r.toFixed(0)}ms`}),console.log("[BgRemoval] Library loaded"),de}).catch(e=>{throw ie=null,e}),ie}function Ge(o){const[e,r]=o.split(","),n=e.match(/:(.*?);/),s=n?n[1]:"image/png",a=atob(r),l=new Uint8Array(a.length);for(let i=0;i<a.length;i++)l[i]=a.charCodeAt(i);return new Blob([l],{type:s})}function ht(o){return new Promise((e,r)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=r,n.readAsDataURL(o)})}async function Ue(o){B.log("Starting background removal",{inputLength:o==null?void 0:o.length}),console.log("[BgRemoval] Starting background removal...");const e=performance.now();try{B.log("Step 1: Loading library");const r=await pt();B.log("Step 2: Converting data URL to Blob");const n=Ge(o);B.log("Step 2 complete: Input prepared",{inputSize:`${(n.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Input size: ${(n.size/1024).toFixed(1)} KB`),B.log("Step 3: Calling removeBackground() - this may take a while...");const s=performance.now(),a=await r(n,gt),l=performance.now()-s;B.log("Step 3 complete: Background removed",{processingTime:`${l.toFixed(0)}ms`,resultSize:`${(a.size/1024).toFixed(1)} KB`}),B.log("Step 4: Converting result to data URL");const i=await ht(a),d=performance.now()-e;return B.log("Background removal complete",{totalDuration:`${d.toFixed(0)}ms`,inputSize:`${(n.size/1024).toFixed(1)} KB`,outputSize:`${(a.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Complete in ${d.toFixed(0)}ms`),console.log(`[BgRemoval] Output size: ${(a.size/1024).toFixed(1)} KB`),i}catch(r){throw B.error("Background removal failed",r),console.error("[BgRemoval] Error:",r),new Error(`Background removal failed: ${r.message}`)}}const C=ee("CacheStorage"),ft="wedding-invite-cache",vt=1,ne="processed-images",Fe="processed-images-metadata";function we(){try{return!!window.indexedDB}catch{return!1}}function ze(){return new Promise((o,e)=>{if(!we()){C.warn("IndexedDB not supported, using localStorage fallback"),e(new Error("IndexedDB not supported"));return}const r=window.indexedDB.open(ft,vt);r.onerror=()=>e(r.error),r.onsuccess=()=>o(r.result),r.onupgradeneeded=n=>{const s=n.target.result;s.objectStoreNames.contains(ne)||(s.createObjectStore(ne,{keyPath:"image_id"}),C.log("Created IndexedDB object store"))}})}function Pe(o){const e=`${o.size}-${o.lastModified}`;return btoa(e).replace(/[+/=]/g,"").substring(0,16)}async function ke(o,e){try{const r=Date.now(),n="1.0";if(we())try{const a=(await ze()).transaction([ne],"readwrite"),l=a.objectStore(ne),i=wt(e);l.put({image_id:o,data:i,processing_version:n,timestamp:r}),await new Promise((d,p)=>{a.oncomplete=d,a.onerror=()=>p(a.error)}),C.log("Image cached in IndexedDB",{image_id:o,size:`${(i.size/1024).toFixed(1)} KB`,timestamp:r})}catch(s){C.warn("IndexedDB save failed, trying localStorage",s.message),je(o,n,r)}else je(o,n,r)}catch(r){C.error("Failed to cache image",r.message)}}async function _e(o){try{if(!xt(o))return C.log("No cached image found for ID",{image_id:o}),null;if(we())try{const a=(await ze()).transaction([ne],"readonly").objectStore(ne).get(o);return new Promise((l,i)=>{a.onsuccess=()=>{const d=a.result;if(d){C.log("Retrieved cached image from IndexedDB",{image_id:o,timestamp:d.timestamp});const p=new FileReader;p.onload=()=>{l(p.result)},p.onerror=()=>{C.warn("Failed to read cached blob"),l(null)},p.readAsDataURL(d.data)}else C.log("Image not found in IndexedDB"),l(null)},a.onerror=()=>i(a.error)})}catch(r){return C.warn("IndexedDB load failed",r.message),null}return null}catch(e){return C.error("Failed to load cached image",e.message),null}}function je(o,e,r){try{const n={image_id:o,processing_version:e,timestamp:r,cached_at:new Date().toISOString()};localStorage.setItem(`${Fe}-${o}`,JSON.stringify(n)),C.log("Saved metadata to localStorage",{image_id:o})}catch(n){C.warn("Failed to save metadata to localStorage",n.message)}}function xt(o){try{const e=localStorage.getItem(`${Fe}-${o}`);return e?JSON.parse(e):null}catch(e){return C.warn("Failed to load metadata from localStorage",e.message),null}}function wt(o){const[e,r]=o.split(","),n=e.match(/:(.*?);/),s=n?n[1]:"image/png",a=atob(r),l=new Uint8Array(a.length);for(let i=0;i<a.length;i++)l[i]=a.charCodeAt(i);return new Blob([l],{type:s})}function Le(o,e="1.0"){return o?o.processing_version!==e?(C.log("Cache invalid due to processing version mismatch",{cached_version:o.processing_version,current_version:e}),!1):!0:!1}const P=ee("ImageProcessing"),Ce="1.0",St={extraction:6e4,generation:3e5,evaluation:6e4,bg_removing:12e4},bt={extraction:2,generation:1,evaluation:2,bg_removing:1},S={IDLE:"idle",UPLOADED:"uploaded",EXTRACTING:"extracting",GENERATING:"generating",EVALUATING:"evaluating",BG_REMOVING:"bg_removing",READY:"ready",FAILED:"failed"};class Et{constructor(){this.state=S.IDLE,this.imageId=null,this.originalImage=null,this.processedImage=null,this.currentStep=null,this.progress=0,this.error=null,this.abortController=null,this.listeners=[],this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1}on(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(r=>r!==e)}}_notify(){this.listeners.forEach(e=>{e({state:this.state,step:this.currentStep,progress:this.progress,error:this.error,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed})})}async startProcessingFromGeneration(e,r,n,s={}){if(this.state!==S.IDLE&&this.state!==S.UPLOADED){P.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Pe(e),this.originalImage=e,this.error=null,this.progress=0,this.extractionComplete=!0,this.extractedDescriptions=n,this.isPhotoProcessed=!1,P.log("Starting image processing from generation step",{image_id:this.imageId,photoSize:`${(e.size/1024).toFixed(1)} KB`,photoType:e.type,hasDescriptions:!!n});try{const a=await _e(this.imageId);if(a&&Le({processing_version:Ce})){P.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=a,this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify();return}}catch(a){P.warn("Failed to check cache, continuing with pipeline",a.message)}this.state=S.UPLOADED,this._notify();try{if(s.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(e,r,s),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(s.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(e,r,s),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await ke(this.imageId,this.processedImage)}catch(a){P.warn("Failed to save to cache, continuing",a.message)}this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),P.log("Image processing pipeline complete (from generation)",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(a){a.name==="AbortError"?(P.log("Processing cancelled by user"),this.state=S.IDLE):(P.error("Pipeline failed",a.message),this.error=a.message,this.state=S.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async startProcessing(e,r,n={}){if(this.state!==S.IDLE&&this.state!==S.UPLOADED){P.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Pe(e),this.originalImage=e,this.error=null,this.progress=0,this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1,P.log("Starting image processing pipeline",{image_id:this.imageId,photoSize:`${(e.size/1024).toFixed(1)} KB`,photoType:e.type});try{const s=await _e(this.imageId);if(s&&Le({processing_version:Ce})){P.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=s,this.state=S.READY,this.progress=100,this._notify();return}}catch(s){P.warn("Failed to check cache, continuing with pipeline",s.message)}this.state=S.UPLOADED,this._notify();try{if(await this._runStep("extraction",()=>this._extractImage(e),"Extracting image features..."),this.extractionComplete=!0,this._notify(),this.abortController.signal.aborted){this._abort();return}if(n.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(e,r,n),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(n.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(e,r,n),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await ke(this.imageId,this.processedImage)}catch(s){P.warn("Failed to save to cache, continuing",s.message)}this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),P.log("Image processing pipeline complete",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(s){s.name==="AbortError"?(P.log("Processing cancelled by user"),this.state=S.IDLE):(P.error("Pipeline failed",s.message),this.error=s.message,this.state=S.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async _runStep(e,r,n){const s=St[e],a=bt[e];this.currentStep=e,this.state=this._stateForStep(e),this._notify(),P.log(`Step ${e} starting`,{userMessage:n,timeout:s,maxRetries:a});let l;for(let i=0;i<a;i++)try{const d=await this._withTimeout(r(),s);return P.log(`Step ${e} completed`,{attempt:i+1}),d}catch(d){l=d,P.warn(`Step ${e} failed on attempt ${i+1}`,{error:d.message,willRetry:i<a-1}),i<a-1&&await new Promise(p=>setTimeout(p,1e3*(i+1)))}throw new Error(`Step ${e} failed after ${a} retries: ${l.message}`)}_stateForStep(e){return{extraction:S.EXTRACTING,generation:S.GENERATING,evaluation:S.EVALUATING,bg_removing:S.BG_REMOVING}[e]||S.IDLE}async _extractImage(e){return this.progress=10,this._notify(),new Promise((r,n)=>{const s=new FileReader;s.onload=()=>{this.processedImage=s.result,this.progress=20,this._notify(),r(s.result)},s.onerror=()=>n(new Error("Failed to read image file")),s.readAsDataURL(e)})}async _generateImage(e,r,n){if(this.progress=30,this._notify(),n.skipImageGeneration)return this.processedImage;const s=new FormData;s.append("photo",e);const a=await fetch(`${r}/api/generate`,{method:"POST",body:s,signal:this.abortController.signal});if(!a.ok)throw new Error(`API error: ${a.statusText}`);const l=await a.json();if(!l.success)throw new Error(l.error||"Generation failed");return this.processedImage=l.characterImage,this.progress=40,this._notify(),this.processedImage}async _evaluateImage(e,r,n){return this.progress=50,this._notify(),this.progress=60,this._notify(),{passed:!0,score:1}}async _removeBackground(){this.progress=70,this._notify();try{return this.processedImage=await Ue(this.processedImage),this.progress=80,this._notify(),this.processedImage}catch(e){return P.warn("Background removal failed, using original image",e.message),this.progress=80,this._notify(),this.processedImage}}cancel(){P.log("Cancelling image processing"),this.abortController&&this.abortController.abort(),this._abort()}isPhotoFullyProcessed(){return this.isPhotoProcessed}_abort(){this.state=S.IDLE,this.progress=0,this.currentStep=null,this._notify()}_withTimeout(e,r){return Promise.race([e,new Promise((n,s)=>setTimeout(()=>s(new Error(`Operation timed out after ${r}ms`)),r))])}_fileToDataURL(e){return new Promise((r,n)=>{const s=new FileReader;s.onload=()=>r(s.result),s.onerror=()=>n(new Error("Failed to read file")),s.readAsDataURL(e)})}_estimateDataURLSize(e){if(!e)return 0;const r=e.split(",")[1]||"";return Math.ceil(r.length*.75)}getStatus(){return{state:this.state,step:this.currentStep,progress:this.progress,error:this.error,isReady:this.state===S.READY,isFailed:this.state===S.FAILED,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed}}isDone(){return this.state===S.READY||this.state===S.FAILED}isImageReady(){return this.state===S.READY&&!!this.processedImage}}let se=null;function yt(){return se||(se=new Et),se}function Nt(){se&&(se.cancel(),se=null)}const J=ee("PhotoUploadScreen"),It=10*1024*1024,Rt=["image/jpeg","image/png","image/webp","image/gif"],Pt=o=>o?o.size>It?{valid:!1,error:"File too large. Maximum size is 10MB."}:Rt.includes(o.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"};function kt({onPhotoSelected:o,apiUrl:e}){const[r,n]=c.useState(null),[s,a]=c.useState(null),l=c.useRef(null),[i,d]=c.useState(null),p=c.useRef(null),[u,v]=c.useState({status:"idle",descriptions:null,error:null}),[N,f]=c.useState(0),w=c.useRef(null),b=c.useRef(null);c.useEffect(()=>{pe("photo_upload")},[]),c.useEffect(()=>{p.current=yt()},[]),c.useEffect(()=>p.current?p.current.on(k=>{d(k),J.log("Processing state updated",{state:k.state,step:k.step,progress:k.progress})}):void 0,[]),c.useEffect(()=>{if(r){const y=URL.createObjectURL(r);return a(y),()=>URL.revokeObjectURL(y)}},[r]),c.useEffect(()=>{if(u.status==="uploading"&&N<90)return w.current=setInterval(()=>{f(y=>{const k=y+2;return k>=90?90:k})},1e3),()=>{w.current&&(clearInterval(w.current),w.current=null)};w.current&&(clearInterval(w.current),w.current=null)},[u.status,N]),c.useEffect(()=>{if(!r||e===void 0)return;b.current=new AbortController;const y=b.current.signal;return(async()=>{var T,K;f(0),v({status:"uploading",descriptions:null,error:null}),J.log("[EXTRACTION] Step 1: Preparing photo for extraction",{photoSize:`${(r.size/1024).toFixed(1)} KB`,photoType:r.type,photoName:r.name}),console.log("[Frontend] Preparing photo for extraction...");try{const $=new FormData;$.append("photo",r),J.log("[EXTRACTION] Step 2: Sending photo to backend, waiting for response..."),console.log("[Frontend] Sending photo to backend, waiting for response...");const W=await fetch(`${e}/api/extract`,{method:"POST",body:$,signal:y});if(J.log("[EXTRACTION] Step 3: Response received from backend",{status:W.status,ok:W.ok}),console.log("[Frontend] Response received from backend"),!W.ok){const M=await W.json().catch(()=>({error:"Extraction failed"}));throw new Error(M.error||"Extraction failed")}const m=await W.json();if(!m.success)throw new Error(m.error||"Extraction failed");J.log("[EXTRACTION] Step 4: Extraction complete - response parsed successfully",{hasBride:!!((T=m.descriptions)!=null&&T.bride),hasGroom:!!((K=m.descriptions)!=null&&K.groom)}),console.log("[Frontend] Extraction complete - response parsed successfully"),f(100),v({status:"complete",descriptions:m.descriptions,error:null}),p.current&&(J.log("[BACKGROUND] Starting background processing after extraction",{photoSize:`${(r.size/1024).toFixed(1)} KB`}),console.log("[Frontend] Starting background processing (generation ‚Üí evaluation ‚Üí bg removal)..."),p.current.startProcessingFromGeneration(r,e,m.descriptions,{skipImageGeneration:!1,skipEvaluation:!1,skipBackgroundRemoval:!1}))}catch($){if($.name==="AbortError"){J.log("[EXTRACTION] Extraction cancelled by user"),console.log("[Frontend] Extraction cancelled by user");return}J.error("[EXTRACTION] Extraction failed",$),console.error("[Frontend] Extraction failed:",$.message),f(0),v({status:"failed",descriptions:null,error:$.message})}})(),()=>{b.current&&b.current.abort()}},[r,e]);const U=y=>{const k=Array.from(y.target.files||[]);if(k.length===0)return;const T=k[0],K=Pt(T);if(!K.valid){alert(K.error),y.target.value="";return}Z("photo_selected",{size:`${(T.size/1024).toFixed(1)} KB`,type:T.type}),n(T),y.target.value=""},_=y=>{var k;y==null||y.stopPropagation(),b.current&&(b.current.abort(),b.current=null),p.current&&p.current.cancel(),n(null),a(null),f(0),v({status:"idle",descriptions:null,error:null}),d(null),Z("photo_change_click"),(k=l.current)==null||k.click()},D=()=>{if(!r){alert("Please upload a photo first");return}u.status==="complete"&&(Z("photo_upload_proceed",{extractionStatus:u.status,processingState:i==null?void 0:i.state,isProcessingComplete:(i==null?void 0:i.state)==="ready"}),o({photo:r,descriptions:u.descriptions,processingService:p.current,processingState:i}))},E=u.status==="uploading",V=u.status==="complete",te=u.status==="failed";return t.jsx("div",{className:"input-screen photo-upload-screen",children:t.jsxs("div",{className:"form",children:[t.jsx("div",{className:V?"status-message-box status-success":"hero-container",children:V?t.jsx("span",{children:"‚úì ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à! (Photo uploaded!)"}):t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Photo Upload / ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§°"}),t.jsx("p",{className:"form-hint",children:"‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Choose a clear, good quality photo)"})]})}),t.jsxs("div",{className:"form-group",children:[t.jsx("label",{children:"Couple Photo / ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),r?t.jsx("div",{className:"photo-single",children:t.jsx("div",{className:"photo-card photo-card-clickable",onClick:_,style:{cursor:"pointer"},children:t.jsxs("div",{className:"photo-preview",style:{position:"relative",width:"100%",height:"auto",maxWidth:"280px"},children:[t.jsx("img",{src:s,alt:"Selected photo",style:{width:"100%",height:"auto",display:"block"}}),t.jsx("button",{type:"button",className:"change-photo-btn",onClick:_,"aria-label":"Change photo",children:"Change Photo"}),E&&t.jsx("div",{className:"processing-overlay",children:t.jsxs("div",{className:"processing-indicator",children:[t.jsx("div",{className:"spinner"}),t.jsx("p",{className:"processing-text",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç (Please wait...)"}),t.jsxs("div",{className:"upload-progress-bar",children:[t.jsx("div",{className:"upload-progress-fill",style:{width:`${N}%`}}),t.jsxs("span",{className:"upload-progress-text",children:[Math.round(N),"%"]})]})]})})]})})}):t.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var y;Z("photo_upload_click"),(y=l.current)==null||y.click()},children:[t.jsx("span",{className:"upload-icon",children:"+"}),t.jsx("span",{className:"upload-text-hindi",children:"‡§Ö‡§™‡§®‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç"}),t.jsx("span",{className:"upload-hint",children:"Select Your Photo"})]})]}),te&&t.jsxs("div",{className:"status-message-box status-error",children:[t.jsxs("span",{children:["‚ö† ‡§Ö‡§™‡§≤‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ",u.error]}),t.jsx("span",{className:"status-hint",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç (Please try again)"})]}),t.jsx("button",{type:"button",className:"generate-btn",onClick:D,disabled:!r||E||te,children:E?"‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... (Uploading...)":V?"‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç (Continue)":"‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Select Photo)"}),t.jsx("input",{type:"file",ref:l,accept:"image/*",onChange:U,style:{display:"none"}})]})})}var Ae;(function(o){o.LOAD="LOAD",o.EXEC="EXEC",o.FFPROBE="FFPROBE",o.WRITE_FILE="WRITE_FILE",o.READ_FILE="READ_FILE",o.DELETE_FILE="DELETE_FILE",o.RENAME="RENAME",o.CREATE_DIR="CREATE_DIR",o.LIST_DIR="LIST_DIR",o.DELETE_DIR="DELETE_DIR",o.ERROR="ERROR",o.DOWNLOAD="DOWNLOAD",o.PROGRESS="PROGRESS",o.LOG="LOG",o.MOUNT="MOUNT",o.UNMOUNT="UNMOUNT"})(Ae||(Ae={}));var Oe;(function(o){o.MEMFS="MEMFS",o.NODEFS="NODEFS",o.NODERAWFS="NODERAWFS",o.IDBFS="IDBFS",o.WORKERFS="WORKERFS",o.PROXYFS="PROXYFS"})(Oe||(Oe={}));const z=ee("VideoComposer"),_t="https://marwadi-nyota.onrender.com".replace(/\/+$/,"");async function jt(o,e=1080){return new Promise(r=>{const n=new Image;n.onload=()=>{const s=document.createElement("canvas");let{width:a,height:l}=n;a>e&&(l=l*e/a,a=e),s.width=a,s.height=l,s.getContext("2d").drawImage(n,0,0,a,l),s.toBlob(d=>r(d),"image/png",.85)},n.src=o})}async function Lt({characterImage:o,brideName:e,groomName:r,date:n,venue:s,onProgress:a}){const l=performance.now();z.log("Starting server-side video composition",{characterImageLength:o==null?void 0:o.length,brideName:e,groomName:r,date:n,venue:s});const i=new FormData;if(o){const d=await jt(o);i.append("characterImage",d,"character.png")}return i.append("brideName",e),i.append("groomName",r),i.append("date",n),i.append("venue",s),new Promise((d,p)=>{const u=new XMLHttpRequest;u.upload.onprogress=f=>{if(f.lengthComputable){const w=Math.round(f.loaded/f.total*30);z.log("Server compose upload progress",{progress:`${w}%`}),a(w)}},u.onload=()=>{if(u.status===200){const f=u.getResponseHeader("Content-Type");if(!f||!f.includes("video/mp4")){z.error("Server compose returned non-video response",{contentType:f}),p(new Error("Server returned non-video response. Check API URL configuration."));return}const w=performance.now()-l,b=u.response;z.log("Server-side video composition complete",{totalTime:`${w.toFixed(0)}ms`,outputSize:`${(b.size/1024/1024).toFixed(2)} MB`}),a(100),d(b)}else{z.error("Server compose failed",{status:u.status,statusText:u.statusText});try{const f=u.responseText,w=JSON.parse(f);p(new Error(w.error||"Server composition failed"))}catch(f){const w=u.responseText||"(empty response)",b=u.getResponseHeader("Content-Type")||"(not set)",U=u.getResponseHeader("Content-Length")||"(not set)";z.error("Server compose response unparseable",{status:u.status,statusText:u.statusText,contentType:b,contentLength:U,responseLength:w.length,firstChars:w.slice(0,300),parseError:f.message}),p(new Error("Server composition failed: unexpected response"))}}},u.onerror=()=>{const f=performance.now()-l;z.error("Server compose network error",{totalTime:`${f.toFixed(0)}ms`}),p(new Error("Network error during video composition"))},u.ontimeout=()=>{z.error("Server compose timeout"),p(new Error("Video composition timed out"))};let v=30;const N=setInterval(()=>{v<85&&(v+=2,a(v))},1e3);u.onloadend=()=>{clearInterval(N)},u.open("POST",`${_t}/api/compose-video`),u.responseType="blob",u.timeout=3e5,u.send(i)})}async function Ct({characterImage:o,brideName:e,groomName:r,date:n,venue:s,onProgress:a=()=>{}}){const l=performance.now();z.log("=== VIDEO COMPOSITION STARTED (SERVER-SIDE) ===",{brideName:e,groomName:r,date:n,venue:s,characterImageSize:o?`${(o.length/1024).toFixed(1)}KB`:"N/A",timestamp:new Date().toISOString(),userAgent:navigator.userAgent.slice(0,100)}),a(5);try{const i=await Lt({characterImage:o,brideName:e,groomName:r,date:n,venue:s,onProgress:a}),d=performance.now()-l;return z.log("=== VIDEO COMPOSITION COMPLETE (SERVER) ===",{totalTime:`${d.toFixed(0)}ms`,totalTimeHuman:`${(d/1e3).toFixed(1)}s`,outputSize:`${(i.size/1024/1024).toFixed(2)} MB`}),i}catch(i){const d=performance.now()-l;throw z.error("=== VIDEO COMPOSITION FAILED ===",{error:i.message,failedAfter:`${d.toFixed(0)}ms`}),i}}const At=c.lazy(()=>Be(()=>import("./ResultScreen-sT8fT2vn.js"),__vite__mapDeps([2,1]))),g=ee("App"),Ot=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),t.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Dt=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),t.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),t.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),De="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),R={SAMPLE_VIDEO:"sample_video",PHOTO_UPLOAD:"photo_upload",INPUT:"input",LOADING:"loading",RESULT:"result"},Tt=500,Ve=3,$t=1e3;async function Bt(o,e,r=Ve,n=null){let s;const a=n?{...e,signal:n}:e;for(let l=0;l<r;l++){if(n!=null&&n.aborted)throw new DOMException("Request was cancelled","AbortError");try{const i=await fetch(o,a);if(i.ok||i.status>=400&&i.status<500)return i;s=new Error(`Server error: ${i.status}`),g.warn(`API attempt ${l+1} failed with status ${i.status}`)}catch(i){if(i.name==="AbortError")throw i;s=i,g.warn(`API attempt ${l+1} failed: ${i.message}`)}if(l<r-1){const i=$t*Math.pow(2,l);g.log(`Retrying in ${i}ms...`),await new Promise(d=>setTimeout(d,i))}}throw s}function Mt(){const[o,e]=c.useState(typeof navigator<"u"?navigator.onLine:!0);return c.useEffect(()=>{const r=()=>{e(!0),g.log("Network status: online")},n=()=>{e(!1),g.log("Network status: offline")};return window.addEventListener("online",r),window.addEventListener("offline",n),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}},[]),o}function Gt(){const[o,e]=c.useState(R.SAMPLE_VIDEO),[r,n]=c.useState(null),[s,a]=c.useState(null),[l,i]=c.useState(null),[d,p]=c.useState(!1),[u,v]=c.useState(null),[N,f]=c.useState({state:"idle"}),w=c.useRef(null),b=Mt(),[U,_]=c.useState(!0),D=c.useRef(null),E=c.useRef(null);c.useEffect(()=>{const m=new Audio("/assets/bg_audio.mp3");return m.loop=!0,m.volume=.05,D.current=m,()=>{m.pause(),m.src=""}},[]);const V=c.useCallback(()=>{D.current&&(U?(D.current.pause(),_(!1)):(D.current.play().catch(()=>{console.log("[App] Could not play audio")}),_(!0)))},[U]);c.useEffect(()=>{D.current&&(o===R.LOADING?(D.current.play().catch(()=>{_(!1)}),_(!0)):(D.current.pause(),D.current.currentTime=0,_(!1)))},[o]);const te=c.useCallback(()=>{g.log("Sample video complete, navigating to photo upload"),e(R.PHOTO_UPLOAD)},[]),y=c.useCallback(({photo:m,processingService:M,processingState:A})=>{g.log("Photo selected, navigating to input form",{photoSize:`${(m.size/1024).toFixed(1)} KB`,processingState:A==null?void 0:A.state}),v(m),w.current=M,f(A||{state:"idle"}),M&&M.on(G=>{f(G)}),e(R.INPUT)},[]),k=m=>new Promise((M,A)=>{if(m.isDone()){M(m.getStatus());return}const G=m.on(Y=>{Y.state===S.READY?(G(),M(Y)):Y.state===S.FAILED&&(G(),A(new Error(Y.error||"Processing failed")))})}),T=c.useCallback(async m=>{var A,G,Y,ce,oe;E.current=new AbortController;const M=E.current.signal;n(m),e(R.LOADING),p(!1),i(null),g.log("Generation started",{devMode:m.devMode,brideName:m.brideName,groomName:m.groomName,hasPhoto:!!m.photo,hasCharacterFile:!!m.characterFile,skipExtraction:m.skipExtraction,skipImageGeneration:m.skipImageGeneration,skipBackgroundRemoval:m.skipBackgroundRemoval,skipVideoGeneration:m.skipVideoGeneration,videoComposition:"server-side"});try{let h;const x=w.current,he=m.devMode&&(m.skipExtraction||m.skipImageGeneration),j=((A=x==null?void 0:x.isPhotoFullyProcessed)==null?void 0:A.call(x))||!1,F=(G=x==null?void 0:x.getStatus())==null?void 0:G.state,L=F&&F!=="idle";if(g.log("Step 1: Checking photo processing status",{isPhotoProcessed:j,serviceState:F,processingStarted:L,isImageReady:x==null?void 0:x.isImageReady()}),x&&!j&&L&&!x.isDone()){g.log("Step 1: Photo not fully processed, waiting for processing to complete");try{const I=await k(x);h=I.processedImage,g.log("Step 1 complete: Photo processing finished",{imageLength:h==null?void 0:h.length,isPhotoProcessed:I.isPhotoProcessed})}catch(I){g.warn("Step 1: Photo processing failed, using fallback",I.message),h=x.getStatus().processedImage}}else if(x!=null&&x.isImageReady()&&j)g.log("Step 1: Using pre-processed image from background service"),h=x.getStatus().processedImage,g.log("Step 1 complete: Pre-processed image ready",{imageLength:h==null?void 0:h.length});else if(L&&!x.isDone()){g.log("Step 1: Background processing active, waiting",{state:F});try{h=(await k(x)).processedImage,g.log("Step 1 complete: Background processing finished",{imageLength:h==null?void 0:h.length})}catch(I){g.warn("Step 1: Background processing failed, using fallback",I.message),h=x.getStatus().processedImage}}else L&&x.isDone()?(h=x.getStatus().processedImage,g.log("Step 1: Using completed processing result",{imageLength:h==null?void 0:h.length,state:F})):he&&m.characterFile&&(g.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:m.characterFile.name,fileSize:`${(m.characterFile.size/1024).toFixed(1)} KB`,fileType:m.characterFile.type}),h=await new Promise((I,H)=>{const O=new FileReader;O.onload=()=>I(O.result),O.onerror=()=>H(new Error("Failed to read character file")),O.readAsDataURL(m.characterFile)}),g.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:h.length}));if(!h){if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const I=new FormData;I.append("photo",m.photo),g.log("Step 1: Calling backend API (fallback)",{photoName:m.photo.name,photoSize:`${(m.photo.size/1024).toFixed(1)} KB`,photoType:m.photo.type});const H=performance.now(),O=await Bt(`${De}/api/generate`,{method:"POST",body:I},Ve,M);g.log("Step 1 response received",{status:O.status,ok:O.ok,duration:`${(performance.now()-H).toFixed(0)}ms`});const Se=O.headers.get("content-type");if(!Se||!Se.includes("application/json"))throw new Error("Server returned non-JSON response. Check API URL configuration.");const X=await O.json();if(!X.success)throw g.error("Step 1 failed",X.error||"Generation failed"),new Error(X.error||"Generation failed");g.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!X.characterImage,imageLength:(Y=X.characterImage)==null?void 0:Y.length,evaluationScore:(ce=X.evaluation)==null?void 0:ce.score,evaluationPassed:(oe=X.evaluation)==null?void 0:oe.passed}),h=X.characterImage}if((x==null?void 0:x.isImageReady())||x&&!x.isDone())g.log("Step 2: Skipping background removal (already done by processing service)");else if(m.skipBackgroundRemoval)g.log("Step 2: Skipping background removal (dev mode toggle)");else{g.log("Step 2: Starting background removal");const I=performance.now();try{h=await Ue(h),g.log("Step 2 complete: Background removal successful",{outputLength:h==null?void 0:h.length,duration:`${(performance.now()-I).toFixed(0)}ms`})}catch(H){g.warn("Step 2",`Background removal failed, using original: ${H.message}`)}}let q;if(m.skipVideoGeneration)g.log("Step 3: Skipping video generation (dev mode toggle)"),q=Ge(h),g.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((q==null?void 0:q.size)/1024).toFixed(1)} KB`});else{g.log("Step 3: Starting video composition (server-side)",{brideName:m.brideName,groomName:m.groomName,date:m.date,venue:m.venue,characterImageLength:h==null?void 0:h.length});const I=performance.now();let H=0;q=await Ct({characterImage:h,brideName:m.brideName,groomName:m.groomName,date:m.date,venue:m.venue,onProgress:O=>{(O>=H+20||O===100)&&(g.log("Video composition progress",{progress:`${O}%`,elapsed:`${(performance.now()-I).toFixed(0)}ms`}),H=O)}}),g.log("Step 3 complete: Video composition finished",{videoSize:`${((q==null?void 0:q.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-I).toFixed(0)}ms`})}if(a(q),!m.devMode){const I=at();g.log("Rate limit updated",{count:I.count,remaining:I.remaining})}g.log("Step 4: Showing completion state"),p(!0),await new Promise(I=>setTimeout(I,Tt)),g.log("Step 5: Transitioning to result screen"),e(R.RESULT),g.log("Generation complete - all steps successful")}catch(h){if(h.name==="AbortError"){g.log("Generation cancelled by user");return}g.error("Generation failed",h),i(h.message),e(R.INPUT)}},[]),K=c.useCallback(()=>{E.current&&(E.current.abort(),E.current=null),g.log("User cancelled generation"),e(R.INPUT),n(null),a(null),p(!1),i(null)},[]),$=c.useCallback(()=>{w.current&&w.current.cancel(),Nt(),w.current=null,e(R.SAMPLE_VIDEO),n(null),a(null),v(null),f({state:"idle"}),i(null)},[]);c.useCallback(()=>{g.log("Back button clicked",{currentScreen:o}),o===R.PHOTO_UPLOAD?e(R.SAMPLE_VIDEO):o===R.INPUT?e(R.PHOTO_UPLOAD):o===R.RESULT&&e(R.INPUT)},[o]);const W=()=>t.jsx("div",{className:"loading-fallback",children:t.jsx("div",{className:"loading-spinner"})});return t.jsxs("div",{className:"app",children:[!b&&t.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),t.jsxs("header",{className:"app-header",children:[t.jsx("div",{className:"app-header-left",children:t.jsx("div",{className:"app-header-logo",children:t.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})})}),t.jsxs("div",{className:"app-header-title",children:[t.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),t.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),t.jsx("div",{className:"app-header-actions",children:o===R.LOADING&&t.jsx("button",{className:"music-toggle-btn",onClick:V,"aria-label":U?"Mute background music":"Play background music",title:U?"Mute music":"Play music",children:U?t.jsx(Ot,{}):t.jsx(Dt,{})})})]}),o===R.SAMPLE_VIDEO&&t.jsx(mt,{onProceed:te}),o===R.PHOTO_UPLOAD&&t.jsx(kt,{onPhotoSelected:y,apiUrl:De}),o===R.INPUT&&t.jsx(dt,{onGenerate:T,error:l,photo:u,onBack:()=>e(R.PHOTO_UPLOAD)}),o===R.LOADING&&t.jsx(ut,{completed:d,onCancel:K}),t.jsx(c.Suspense,{fallback:t.jsx(W,{}),children:o===R.RESULT&&t.jsx(At,{inviteVideo:s,brideName:r==null?void 0:r.brideName,groomName:r==null?void 0:r.groomName,onReset:$})})]})}xe.createRoot(document.getElementById("root")).render(t.jsx(We.StrictMode,{children:t.jsx(Gt,{})}));export{Be as _,Z as a,ee as c,t as j,pe as t};
